{"version":3,"sources":["webpack:///static/js/57.c0e710b508902bc34126.js","webpack:///./src/components/book/add_new_chapter.vue","webpack:///src/components/book/add_new_chapter.vue","webpack:///./src/components/book/add_new_chapter.vue?b969"],"names":["webpackJsonp","7ban","module","exports","zCU7","__webpack_exports__","__webpack_require__","injectStyle","context","Object","defineProperty","value","stringify","stringify_default","n","add_new_chapter","data","_this","this","validateContent","rule","callback","ruleForm","chapterLength","Error","loading","isPending","dialogSize","volumeList","isAutoPublish","labelWidth","dialogFormVisible","isVip","volumeForm","volumeName","bookTitle","chapterTitle","volumeId","releaseTime","chapterContent","whetherPublic","chapterIsvip","authorWords","required","validator","$http","trim","length","$ajax","bookid","bookId","json","returnCode","msg","trigger","rules","chapterName","$route","params","bid","type","message","methods","submitForm","_this2","$loading","lock","text","spinner","background","$refs","validate","valid","$nextTick","close","$message","$alert","confirmButtonText","showCancelButton","customClass","cancelButtonText","action","createChapter","_this3","cloneData","JSON","parse","replace","time","$formTime","beijing","$confirm","then","window","scrollTo","resetForm","getChapterInfo","catch","addNewVolume","formName","_this4","bookName","resetFields","_this5","bookWriterId","bookCheckStatus","checkChapterName","event","target","created","windowWidth","document","body","clientWidth","watch","ruleForm.chapterContent","val","ruleForm.authorWords","substr","computed","sLen","str","e","mounted","_this6","onresize","width","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","separator-class","_v","to","ref","model","label-width","labelPosition","label","prop","staticStyle","readonly","$$v","$set","expression","placeholder","_l","item","key","id","nativeOn","click","$event","on","blur","rows","_s","margin-top","span","disabled","change","_e","top","title","visible","open","update:visible","label-position","auto-complete","slot","staticRenderFns","component_normalizer","__vue_styles__","Component"],"mappings":"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","file":"static/js/57.c0e710b508902bc34126.js","sourcesContent":["webpackJsonp([57],{\n\n/***/ \"7ban\":\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ \"zCU7\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\nvar stringify = __webpack_require__(\"3cXf\");\nvar stringify_default = /*#__PURE__*/__webpack_require__.n(stringify);\n\n// CONCATENATED MODULE: ./node_modules/_babel-loader@7.1.4@babel-loader/lib!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=script&index=0!./src/components/book/add_new_chapter.vue\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* harmony default export */ var add_new_chapter = ({\n  data: function data() {\n    var _this = this;\n\n    var validateContent = function validateContent(rule, value, callback) {\n      if (_this.ruleForm.chapterLength) {\n        if (_this.ruleForm.chapterLength > 20000) {\n          callback(new Error('总长度不可超过20000字！'));\n        } else {\n          callback();\n        }\n      } else {\n        callback(new Error('请添加章节内容'));\n      }\n    };\n    var validateVolume = function validateVolume(rule, value, callback) {\n      if (!value || _this.$http.trim(value).length < 1) {\n        _this.volumeForm.volumeName = '';\n        callback(new Error('卷名不能为空'));\n      } else {\n        _this.$ajax('/books-getCheckVolume', {\n          volumeName: value,\n          bookid: _this.ruleForm.bookId\n        }, function (json) {\n          if (json.returnCode === 200) {\n            callback();\n          } else {\n            callback(new Error(json.msg));\n          }\n        });\n      }\n    };\n    var validateCheckCn = function validateCheckCn(rule, value, callback) {\n      value = _this.$http.trim(value);\n      if (!value || _this.$http.trim(value).length < 1) {\n        _this.ruleForm.chapterTitle = '';\n        callback(new Error('请输入章节名称'));\n      } else {\n        _this.$ajax('/chapter-checkName', {\n          chapterName: value,\n          bookId: _this.$route.params.bid\n        }, function (json) {\n          if (json.returnCode === 200) {\n            callback();\n          } else {\n            callback(new Error('章节名重复，请重新填写！'));\n          }\n        });\n      }\n    };\n    return {\n      loading: '',\n      isPending: false, // 避免网络不良时造成重复提交\n      dialogSize: 'tiny',\n      volumeList: [],\n      isAutoPublish: false,\n      labelWidth: '136px',\n      dialogFormVisible: false,\n      isVip: 0,\n      volumeForm: {\n        volumeName: ''\n      },\n      ruleForm: {\n        bookTitle: '',\n        chapterTitle: '',\n        volumeId: null,\n        releaseTime: '',\n        chapterContent: '',\n        whetherPublic: 0,\n        chapterLength: 0,\n        chapterIsvip: 0,\n        authorWords: ''\n      },\n      rule: {\n        volumeName: [{ required: true, validator: validateVolume, trigger: 'blur' }]\n      },\n      rules: {\n        chapterTitle: [{ required: true, validator: validateCheckCn, trigger: 'blur' }],\n        volumeId: [{ required: true, type: 'number', message: '请选择分卷', trigger: 'change' }],\n        bookTitle: [{ required: true, message: '请输入书籍名称', trigger: 'blur' }],\n        chapterContent: [{ required: true, validator: validateContent, trigger: 'change' }]\n      }\n    };\n  },\n\n  methods: {\n    //        添加新章节\n    submitForm: function submitForm(type) {\n      var _this2 = this;\n\n      this.loading = this.$loading({\n        lock: true,\n        text: 'Loading',\n        spinner: 'el-icon-loading',\n        background: 'rgba(0, 0, 0, 0.7)'\n      });\n      this.$refs['ChapterForm'].validate(function (valid) {\n        if (valid) {\n          if (type === 'draft') {\n            _this2.ruleForm.whetherPublic = 1;\n          }\n          if (_this2.ruleForm.chapterIsvip) {\n            _this2.$nextTick(function () {\n              _this2.$loading().close();\n            });\n            _this2.$alert('', '确认设置为收费章节？', {\n              confirmButtonText: '是',\n              showCancelButton: true,\n              customClass: 'small confirm-msg-box',\n              cancelButtonText: '否',\n              callback: function callback(action) {\n                if (action === 'confirm') {\n                  _this2.loading = _this2.$loading({\n                    lock: true,\n                    text: 'Loading',\n                    spinner: 'el-icon-loading',\n                    background: 'rgba(0, 0, 0, 0.7)'\n                  });\n                  _this2.createChapter();\n                }\n              }\n            });\n          } else {\n            _this2.createChapter();\n          }\n        } else {\n          _this2.$nextTick(function () {\n            _this2.loading.close();\n          });\n          _this2.$message({ message: '请完善必填信息！', type: 'warning' });\n          return false;\n        }\n      });\n    },\n    createChapter: function createChapter() {\n      var _this3 = this;\n\n      //          首先获取网络时间\n      var cloneData = JSON.parse(stringify_default()(this.ruleForm));\n      cloneData.chapterContent = this.$http.trim(cloneData.chapterContent).replace(/\\n+\\s+/g, '<H><LG>') + '<H><LG>';\n      this.$ajax('/sys-getNetWorkDateTime', '', function (time) {\n        if (time.returnCode === 200) {\n          if (cloneData.releaseTime) {\n            cloneData.releaseTime = _this3.$formTime(cloneData.releaseTime, 'long');\n          } else {\n            cloneData.releaseTime = _this3.$formTime(time.data.beijing, 'long');\n          }\n          _this3.$ajax('/admin/addAdminCreates', cloneData, function (json) {\n            _this3.$nextTick(function () {\n              _this3.loading.close();\n            });\n            if (json.returnCode === 200) {\n              _this3.$confirm(cloneData.whetherPublic ? '草稿保存成功' : '发布成功', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n              }).then(function () {\n                window.scrollTo(0, 0);\n                _this3.resetForm('ChapterForm');\n                _this3.getChapterInfo();\n              }).catch(function () {\n                window.scrollTo(0, 0);\n                _this3.resetForm('ChapterForm');\n                _this3.getChapterInfo();\n              });\n            }\n          });\n        } else {\n          _this3.$nextTick(function () {\n            _this3.loading.close();\n          });\n        }\n      }, 'get', 'json', true);\n    },\n\n    //      新增分卷\n    addNewVolume: function addNewVolume(formName) {\n      var _this4 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          _this4.$ajax('/books-addvolume', {\n            volumeName: _this4.volumeForm.volumeName,\n            bookName: _this4.ruleForm.bookTitle,\n            bookid: _this4.$route.params.bid\n          }, function (json) {\n            if (json.returnCode === 200) {\n              _this4.dialogFormVisible = false;\n              _this4.$message('添加成功');\n              _this4.getChapterInfo();\n            }\n          });\n        }\n      });\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n\n    //      章节信息回显\n    getChapterInfo: function getChapterInfo() {\n      var _this5 = this;\n\n      this.$ajax('/book-showBookInfo', {\n        bookid: this.$route.params.bid\n      }, function (json) {\n        if (json.returnCode === 200) {\n          _this5.ruleForm.bookTitle = json.data.bookName;\n          _this5.ruleForm.bookId = json.data.bookId;\n          _this5.ruleForm.bookWriterId = json.data.bookWriterId;\n\n          _this5.isVip = json.data.bookCheckStatus;\n          _this5.$ajax('/books-getvolume', { bookId: _this5.$route.params.bid }, function (json) {\n            if (json.returnCode === 200) {\n              _this5.volumeList = json.data;\n            }\n          });\n        }\n      });\n    },\n\n    //      校验章节名是否重复\n    checkChapterName: function checkChapterName(event) {\n      if (event.target.value.length > 0) {}\n    }\n  },\n  created: function created() {\n    var windowWidth = document.body.clientWidth;\n    if (windowWidth < 1020) {\n      this.dialogSize = 'small';\n    } else {\n      this.dialogSize = 'tiny';\n    }\n    this.getChapterInfo();\n  },\n\n  watch: {\n    'ruleForm.chapterContent': function ruleFormChapterContent(val) {\n      this.ruleForm.chapterContent = val.replace(/^\\s*\\n+\\s*/, '').replace(/\\s*\\n+\\s*/g, '\\n\\n　　');\n    },\n    'ruleForm.authorWords': function ruleFormAuthorWords(val) {\n      if (this.$http.trim(val).length > 100) {\n        val = val.substr(0, 100);\n      }\n      this.ruleForm.authorWords = val.replace(/^\\s*\\n+\\s*/, '').replace(/\\s*\\n+\\s*/g, '\\n\\n　　');\n    }\n  },\n  computed: {\n    'length': function length() {\n      var sLen = 0;\n      var str = this.ruleForm.chapterContent;\n      try {\n        // 先将回车换行符做特殊处理\n        str = str.replace(/(\\r\\n+|\\s+| )+/g, '龘');\n        // 处理英文字符数字，连续字母、数字、英文符号视为一个单词\n        //          str = str.replace(/[\\x00-\\xff]/g,\"m\");\n        // 合并字符m，连续字母、数字、英文符号视为一个单词\n        //          str = str.replace(/m+/g,\"*\");\n        // 去掉回车换行符\n        str = str.replace(/龘+/g, '');\n        // 返回字数\n        sLen += str.length;\n      } catch (e) {\n        //   console.log(e)\n      }\n      this.ruleForm.chapterLength = sLen;\n      if (sLen > 20000) {\n        this.$message({ message: '字数长度不可超过20000！', type: 'error' });\n      }\n      return sLen;\n    }\n  },\n  mounted: function mounted() {\n    var _this6 = this;\n\n    window.onresize = function () {\n      var width = document.body.clientWidth;\n      if (width < 1020) {\n        _this6.dialogSize = 'small';\n      } else {\n        _this6.dialogSize = 'tiny';\n      }\n    };\n  }\n});\n// CONCATENATED MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-6f249c6b\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/book/add_new_chapter.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\"},[_c('el-breadcrumb',{staticClass:\"mbt20\",attrs:{\"separator-class\":\"el-icon-arrow-right\"}},[_c('el-breadcrumb-item',[_vm._v(\"书籍管理\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":\"/book/list\"}},[_vm._v(\"书籍列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":'/book_chapter_list/'+_vm.$route.params.bid}},[_vm._v(\"章节列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',[_vm._v(\"新建章节\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"form-wrapper\"},[_c('el-form',{ref:\"ChapterForm\",staticClass:\"chapter-ruleForm\",attrs:{\"model\":_vm.ruleForm,\"rules\":_vm.rules,\"label-width\":_vm.labelWidth,\"labelPosition\":\"left\"}},[_c('el-form-item',{attrs:{\"label\":\"书籍名称\",\"prop\":\"bookTitle\"}},[_c('el-input',{staticStyle:{\"width\":\"260px\"},attrs:{\"readonly\":\"\"},model:{value:(_vm.ruleForm.bookTitle),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"bookTitle\", $$v)},expression:\"ruleForm.bookTitle\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"分卷名称\",\"prop\":\"volumeId\"}},[_c('el-select',{staticStyle:{\"width\":\"260px\"},attrs:{\"placeholder\":\"请选择分卷\"},model:{value:(_vm.ruleForm.volumeId),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"volumeId\", $$v)},expression:\"ruleForm.volumeId\"}},[[_vm._l((_vm.volumeList),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.volumeName,\"value\":item.id}})}),_vm._v(\" \"),_c('el-option',{attrs:{\"label\":\"\",\"value\":\"\"},nativeOn:{\"click\":function($event){_vm.dialogFormVisible = true}}},[_vm._v(\"+新增分卷\")])]],2)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"章节名称\",\"prop\":\"chapterTitle\"}},[_c('el-input',{staticStyle:{\"width\":\"260px\"},on:{\"blur\":function($event){_vm.checkChapterName($event)}},model:{value:(_vm.ruleForm.chapterTitle),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterTitle\", $$v)},expression:\"ruleForm.chapterTitle\"}})],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"contentBox\",attrs:{\"label\":\"章节内容\",\"prop\":\"chapterContent\"}},[_c('el-form-item',[_c('el-input',{staticClass:\"context\",attrs:{\"type\":\"textarea\",\"rows\":15},model:{value:(_vm.ruleForm.chapterContent),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterContent\", $$v)},expression:\"ruleForm.chapterContent\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"prop\":\"authorWords\"}},[_c('el-input',{staticClass:\"authorSay-wrap\",attrs:{\"type\":\"textarea\",\"placeholder\":\"作者的话（不可超过100字）\"},model:{value:(_vm.ruleForm.authorWords),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"authorWords\", $$v)},expression:\"ruleForm.authorWords\"}})],1),_vm._v(\" \"),_c('span',{staticClass:\"words\"},[_vm._v(\"共 \"+_vm._s(_vm.length)+\" 字\")])],1),_vm._v(\" \"),_c('el-form-item',{staticStyle:{\"margin-top\":\"50px\"},attrs:{\"label-width\":_vm.labelWidth,\"label\":\"发布时间\",\"prop\":\"releaseTime\"}},[_c('el-col',{attrs:{\"span\":12}},[_c('el-date-picker',{attrs:{\"type\":\"datetime\",\"disabled\":!_vm.isAutoPublish,\"placeholder\":\"选择时间\"},model:{value:(_vm.ruleForm.releaseTime),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"releaseTime\", $$v)},expression:\"ruleForm.releaseTime\"}}),_vm._v(\" \"),_c('el-checkbox',{staticClass:\"ml20\",attrs:{\"label\":\"定时发布\"},on:{\"change\":function($event){_vm.ruleForm.releaseTime=_vm.isAutoPublish?_vm.ruleForm.releaseTime:''}},model:{value:(_vm.isAutoPublish),callback:function ($$v) {_vm.isAutoPublish=$$v},expression:\"isAutoPublish\"}})],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label-width\":_vm.labelWidth,\"label\":\"是否VIP\",\"prop\":\"chapterIsvip\"}},[_c('el-radio',{staticClass:\"radio\",attrs:{\"label\":0},model:{value:(_vm.ruleForm.chapterIsvip),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterIsvip\", $$v)},expression:\"ruleForm.chapterIsvip\"}},[_vm._v(\"普通\")]),_vm._v(\" \"),(_vm.isVip===2)?_c('el-radio',{staticClass:\"radio\",attrs:{\"label\":1},model:{value:(_vm.ruleForm.chapterIsvip),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterIsvip\", $$v)},expression:\"ruleForm.chapterIsvip\"}},[_vm._v(\"VIP\")]):_vm._e()],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"tc\",staticStyle:{\"width\":\"820px\"},attrs:{\"label-width\":_vm.labelWidth}},[_c('el-button',{staticClass:\"fl\",attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.submitForm('create')}}},[_vm._v(\"立即创建\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"fr save-draft\",on:{\"click\":function($event){_vm.submitForm('draft')}}},[_vm._v(\"保存草稿\")])],1)],1)],1),_vm._v(\" \"),_c('el-dialog',{staticClass:\"alertDialog\",attrs:{\"top\":\"45%\",\"title\":\"新增分卷\",\"visible\":_vm.dialogFormVisible},on:{\"open\":function($event){_vm.volumeForm.volumeName=''},\"update:visible\":function($event){_vm.dialogFormVisible=$event}}},[_c('el-form',{ref:\"volumeForm\",attrs:{\"model\":_vm.volumeForm,\"rules\":_vm.rule,\"label-position\":\"left\"}},[_c('el-form-item',{attrs:{\"label\":\"分卷名称\",\"prop\":\"volumeName\",\"label-width\":'80px'}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.volumeForm.volumeName),callback:function ($$v) {_vm.$set(_vm.volumeForm, \"volumeName\", $$v)},expression:\"volumeForm.volumeName\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogFormVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.addNewVolume('volumeForm')}}},[_vm._v(\"确 定\")])],1)],1)],1)}\nvar staticRenderFns = []\n\n// EXTERNAL MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer.js\nvar component_normalizer = __webpack_require__(\"18Nq\");\n\n// CONCATENATED MODULE: ./src/components/book/add_new_chapter.vue\nfunction injectStyle (context) {\n  __webpack_require__(\"7ban\")\n}\n/* script */\n\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\n\nvar Component = Object(component_normalizer[\"a\" /* default */])(\n  add_new_chapter,\n  render,\n  staticRenderFns,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var book_add_new_chapter = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/57.c0e710b508902bc34126.js","function injectStyle (context) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=styles&index=0!./add_new_chapter.vue\")\n}\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./add_new_chapter.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./add_new_chapter.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6f249c6b\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=template&index=0!./add_new_chapter.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/book/add_new_chapter.vue\n// module id = null\n// module chunks = ","<template>\n  <div class=\"wrapper\">\n    \n    <el-breadcrumb class=\"mbt20\" separator-class=\"el-icon-arrow-right\">\n      <el-breadcrumb-item>书籍管理</el-breadcrumb-item>\n      <el-breadcrumb-item to=\"/book/list\">书籍列表</el-breadcrumb-item>\n      <el-breadcrumb-item :to=\"'/book_chapter_list/'+$route.params.bid\">章节列表</el-breadcrumb-item>\n      <el-breadcrumb-item>新建章节</el-breadcrumb-item>\n    </el-breadcrumb>\n\n    <div class=\"form-wrapper\">\n      <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ChapterForm\" :label-width=\"labelWidth\" labelPosition=\"left\" class=\"chapter-ruleForm\">\n        <el-form-item label=\"书籍名称\" prop=\"bookTitle\">\n          <el-input style=\"width: 260px\" readonly v-model=\"ruleForm.bookTitle\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"分卷名称\" prop=\"volumeId\">\n          <el-select style=\"width: 260px;\" v-model=\"ruleForm.volumeId\" placeholder=\"请选择分卷\">\n            <template>\n              <el-option\n                v-for=\"item in volumeList\"\n                :key=\"item.id\"\n                :label=\"item.volumeName\"\n                :value=\"item.id\">\n              </el-option>\n              <el-option @click.native=\"dialogFormVisible = true\" label=\"\" value=\"\">+新增分卷</el-option>\n            </template>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"章节名称\" prop=\"chapterTitle\">\n          <el-input style=\"width: 260px\" @blur=\"checkChapterName($event)\" v-model=\"ruleForm.chapterTitle\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"章节内容\" class=\"contentBox\" prop=\"chapterContent\">\n          <el-form-item >\n            <el-input class=\"context\" type=\"textarea\" :rows=\"15\"  v-model=\"ruleForm.chapterContent\"></el-input>\n          </el-form-item>\n          <el-form-item prop=\"authorWords\">\n            <el-input class=\"authorSay-wrap\" type=\"textarea\" v-model=\"ruleForm.authorWords\" placeholder=\"作者的话（不可超过100字）\"></el-input>\n          </el-form-item>\n          <span class=\"words\">共 {{length}} 字</span>\n        </el-form-item>\n        \n        <el-form-item :label-width=\"labelWidth\" label=\"发布时间\" style=\"margin-top:50px\" prop=\"releaseTime\">\n          <el-col :span=\"12\">\n            <el-date-picker type=\"datetime\" :disabled=\"!isAutoPublish\" placeholder=\"选择时间\" v-model=\"ruleForm.releaseTime\"></el-date-picker>\n            <el-checkbox  class=\"ml20\" label=\"定时发布\" @change=\"ruleForm.releaseTime=isAutoPublish?ruleForm.releaseTime:''\" v-model=\"isAutoPublish\"></el-checkbox>\n          </el-col>\n          <el-col :span=\"12\">\n            <!--<el-checkbox v-model=\"ruleForm.whetherPublic\">加入草稿箱</el-checkbox>-->\n          </el-col>\n        </el-form-item>\n        <el-form-item :label-width=\"labelWidth\" label=\"是否VIP\" prop=\"chapterIsvip\">\n          <el-radio class=\"radio\" v-model=\"ruleForm.chapterIsvip\" :label=\"0\">普通</el-radio>\n          <el-radio class=\"radio\" v-if=\"isVip===2\" v-model=\"ruleForm.chapterIsvip\" :label=\"1\">VIP</el-radio>\n        </el-form-item>\n        <el-form-item :label-width=\"labelWidth\" style=\"width: 820px\" class=\"tc\">\n          <el-button class=\"fl\" type=\"primary\" @click=\"submitForm('create')\">立即创建</el-button>\n          <el-button class=\"fr save-draft\" @click=\"submitForm('draft')\">保存草稿</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n    \n    <el-dialog\n      class=\"alertDialog\"\n      @open=\"volumeForm.volumeName=''\"\n      top=\"45%\"\n      title=\"新增分卷\"\n      :visible.sync=\"dialogFormVisible\">\n      <el-form :model=\"volumeForm\" :rules=\"rule\" ref=\"volumeForm\" label-position=\"left\">\n        <el-form-item label=\"分卷名称\" prop=\"volumeName\" :label-width=\"'80px'\">\n          <el-input v-model=\"volumeForm.volumeName\" auto-complete=\"off\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"addNewVolume('volumeForm')\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n<script type=\"text/ecmascript-6\">\n  export default {\n    data() {\n      const validateContent = (rule, value, callback) => {\n        if (this.ruleForm.chapterLength) {\n          if (this.ruleForm.chapterLength > 20000) {\n            callback(new Error('总长度不可超过20000字！'))\n          } else {\n            callback()\n          }\n        } else {\n          callback(new Error('请添加章节内容'))\n        }\n      }\n      const validateVolume = (rule, value, callback) => {\n        if (!value || this.$http.trim(value).length < 1) {\n          this.volumeForm.volumeName = ''\n          callback(new Error('卷名不能为空'))\n        } else {\n          this.$ajax('/books-getCheckVolume', {\n            volumeName: value,\n            bookid: this.ruleForm.bookId\n          }, json => {\n            if (json.returnCode === 200) {\n              callback()\n            } else {\n              callback(new Error(json.msg))\n            }\n          })\n        }\n      }\n      const validateCheckCn = (rule, value, callback) => {\n        value = this.$http.trim(value)\n        if (!value || this.$http.trim(value).length < 1) {\n          this.ruleForm.chapterTitle = ''\n          callback(new Error('请输入章节名称'))\n        } else {\n          this.$ajax('/chapter-checkName', {\n            chapterName: value,\n            bookId: this.$route.params.bid\n          }, json => {\n            if (json.returnCode === 200) {\n              callback()\n            } else {\n              callback(new Error('章节名重复，请重新填写！'))\n            }\n          })\n        }\n      }\n      return {\n        loading: '',\n        isPending: false, // 避免网络不良时造成重复提交\n        dialogSize: 'tiny',\n        volumeList: [],\n        isAutoPublish: false,\n        labelWidth: '136px',\n        dialogFormVisible: false,\n        isVip: 0,\n        volumeForm: {\n          volumeName: ''\n        },\n        ruleForm: {\n          bookTitle: '',\n          chapterTitle: '',\n          volumeId: null,\n          releaseTime: '',\n          chapterContent: '',\n          whetherPublic: 0,\n          chapterLength: 0,\n          chapterIsvip: 0,\n          authorWords: ''\n        },\n        rule: {\n          volumeName: [\n            { required: true, validator: validateVolume, trigger: 'blur' }\n          ]\n        },\n        rules: {\n          chapterTitle: [\n            { required: true, validator: validateCheckCn, trigger: 'blur' }\n          ],\n          volumeId: [\n            { required: true, type: 'number', message: '请选择分卷', trigger: 'change' }\n          ],\n          bookTitle: [\n            { required: true, message: '请输入书籍名称', trigger: 'blur' }\n          ],\n          chapterContent: [\n            { required: true, validator: validateContent, trigger: 'change' }\n          ]\n        }\n      }\n  },\n    methods: {\n//        添加新章节\n      submitForm(type) {\n        this.loading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n        this.$refs['ChapterForm'].validate((valid) => {\n          if (valid) {\n            if (type === 'draft') {\n              this.ruleForm.whetherPublic = 1\n            }\n            if (this.ruleForm.chapterIsvip) {\n              this.$nextTick(() => {\n                this.$loading().close()\n              })\n              this.$alert('', '确认设置为收费章节？', {\n                confirmButtonText: '是',\n                showCancelButton: true,\n                customClass: 'small confirm-msg-box',\n                cancelButtonText: '否',\n                callback: (action) => {\n                  if (action === 'confirm') {\n                    this.loading = this.$loading({\n                      lock: true,\n                      text: 'Loading',\n                      spinner: 'el-icon-loading',\n                      background: 'rgba(0, 0, 0, 0.7)'\n                    })\n                    this.createChapter()\n                  }\n                }\n              })\n            } else {\n              this.createChapter()\n            }\n          } else {\n            this.$nextTick(() => {\n              this.loading.close()\n            })\n            this.$message({ message: '请完善必填信息！', type: 'warning' })\n            return false\n          }\n        })\n      },\n      createChapter() {\n        //          首先获取网络时间\n        const cloneData = JSON.parse(JSON.stringify(this.ruleForm))\n        cloneData.chapterContent = this.$http.trim(cloneData.chapterContent).replace(/\\n+\\s+/g, '<H><LG>') + '<H><LG>'\n        this.$ajax('/sys-getNetWorkDateTime', '', time => {\n          if (time.returnCode === 200) {\n            if (cloneData.releaseTime) {\n              cloneData.releaseTime = this.$formTime(cloneData.releaseTime, 'long')\n            } else {\n              cloneData.releaseTime = this.$formTime(time.data.beijing, 'long')\n            }\n            this.$ajax('/admin/addAdminCreates', cloneData, json => {\n              this.$nextTick(() => {\n                this.loading.close()\n              })\n              if (json.returnCode === 200) {\n                this.$confirm(cloneData.whetherPublic ? '草稿保存成功' : '发布成功', '提示', {\n                  confirmButtonText: '确定',\n                  cancelButtonText: '取消',\n                  type: 'warning'\n                }).then(() => {\n                  window.scrollTo(0, 0)\n                  this.resetForm('ChapterForm')\n                  this.getChapterInfo()\n                }).catch(() => {\n                  window.scrollTo(0, 0)\n                  this.resetForm('ChapterForm')\n                  this.getChapterInfo()\n                })\n              }\n            })\n          } else {\n            this.$nextTick(() => {\n              this.loading.close()\n            })\n          }\n        }, 'get', 'json', true)\n      },\n//      新增分卷\n      addNewVolume(formName) {\n        this.$refs[formName].validate((valid) => {\n          if (valid) {\n            this.$ajax('/books-addvolume', {\n              volumeName: this.volumeForm.volumeName,\n              bookName: this.ruleForm.bookTitle,\n              bookid: this.$route.params.bid\n            }, json => {\n              if (json.returnCode === 200) {\n                this.dialogFormVisible = false\n                this.$message('添加成功')\n                this.getChapterInfo()\n              }\n            })\n          }\n        })\n      },\n      resetForm(formName) {\n        this.$refs[formName].resetFields()\n      },\n//      章节信息回显\n      getChapterInfo() {\n        this.$ajax('/book-showBookInfo', {\n          bookid: this.$route.params.bid\n        }, json => {\n          if (json.returnCode === 200) {\n            this.ruleForm.bookTitle = json.data.bookName\n            this.ruleForm.bookId = json.data.bookId\n            this.ruleForm.bookWriterId = json.data.bookWriterId\n  \n            this.isVip = json.data.bookCheckStatus\n            this.$ajax('/books-getvolume', { bookId: this.$route.params.bid }, json => {\n              if (json.returnCode === 200) {\n                this.volumeList = json.data\n              }\n            })\n          }\n        })\n      },\n      //      校验章节名是否重复\n      checkChapterName(event) {\n        if (event.target.value.length > 0) {\n        }\n      }\n    },\n    created() {\n      const windowWidth = document.body.clientWidth\n      if (windowWidth < 1020) {\n        this.dialogSize = 'small'\n      } else {\n        this.dialogSize = 'tiny'\n      }\n      this.getChapterInfo()\n    },\n    watch: {\n      'ruleForm.chapterContent': function(val) {\n        this.ruleForm.chapterContent = val.replace(/^\\s*\\n+\\s*/, '').replace(/\\s*\\n+\\s*/g, '\\n\\n　　')\n      },\n      'ruleForm.authorWords': function(val) {\n        if (this.$http.trim(val).length > 100) {\n          val = val.substr(0, 100)\n        }\n        this.ruleForm.authorWords = val.replace(/^\\s*\\n+\\s*/, '').replace(/\\s*\\n+\\s*/g, '\\n\\n　　')\n      }\n    },\n    computed: {\n      'length': function() {\n        let sLen = 0\n        let str = this.ruleForm.chapterContent\n        try {\n          // 先将回车换行符做特殊处理\n          str = str.replace(/(\\r\\n+|\\s+| )+/g, '龘')\n        // 处理英文字符数字，连续字母、数字、英文符号视为一个单词\n//          str = str.replace(/[\\x00-\\xff]/g,\"m\");\n        // 合并字符m，连续字母、数字、英文符号视为一个单词\n//          str = str.replace(/m+/g,\"*\");\n        // 去掉回车换行符\n          str = str.replace(/龘+/g, '')\n        // 返回字数\n          sLen += str.length\n        } catch (e) {\n        //   console.log(e)\n        }\n        this.ruleForm.chapterLength = sLen\n        if (sLen > 20000) {\n          this.$message({ message: '字数长度不可超过20000！', type: 'error' })\n        }\n        return sLen\n      }\n    },\n    mounted() {\n      window.onresize = () => {\n        const width = document.body.clientWidth\n        if (width < 1020) {\n          this.dialogSize = 'small'\n        } else {\n          this.dialogSize = 'tiny'\n        }\n      }\n    }\n  }\n</script>\n<style lang=\"stylus\" type=\"text/stylus\" rel=\"stylesheet/stylus\">\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/book/add_new_chapter.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\"},[_c('el-breadcrumb',{staticClass:\"mbt20\",attrs:{\"separator-class\":\"el-icon-arrow-right\"}},[_c('el-breadcrumb-item',[_vm._v(\"书籍管理\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":\"/book/list\"}},[_vm._v(\"书籍列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":'/book_chapter_list/'+_vm.$route.params.bid}},[_vm._v(\"章节列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',[_vm._v(\"新建章节\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"form-wrapper\"},[_c('el-form',{ref:\"ChapterForm\",staticClass:\"chapter-ruleForm\",attrs:{\"model\":_vm.ruleForm,\"rules\":_vm.rules,\"label-width\":_vm.labelWidth,\"labelPosition\":\"left\"}},[_c('el-form-item',{attrs:{\"label\":\"书籍名称\",\"prop\":\"bookTitle\"}},[_c('el-input',{staticStyle:{\"width\":\"260px\"},attrs:{\"readonly\":\"\"},model:{value:(_vm.ruleForm.bookTitle),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"bookTitle\", $$v)},expression:\"ruleForm.bookTitle\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"分卷名称\",\"prop\":\"volumeId\"}},[_c('el-select',{staticStyle:{\"width\":\"260px\"},attrs:{\"placeholder\":\"请选择分卷\"},model:{value:(_vm.ruleForm.volumeId),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"volumeId\", $$v)},expression:\"ruleForm.volumeId\"}},[[_vm._l((_vm.volumeList),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.volumeName,\"value\":item.id}})}),_vm._v(\" \"),_c('el-option',{attrs:{\"label\":\"\",\"value\":\"\"},nativeOn:{\"click\":function($event){_vm.dialogFormVisible = true}}},[_vm._v(\"+新增分卷\")])]],2)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"章节名称\",\"prop\":\"chapterTitle\"}},[_c('el-input',{staticStyle:{\"width\":\"260px\"},on:{\"blur\":function($event){_vm.checkChapterName($event)}},model:{value:(_vm.ruleForm.chapterTitle),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterTitle\", $$v)},expression:\"ruleForm.chapterTitle\"}})],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"contentBox\",attrs:{\"label\":\"章节内容\",\"prop\":\"chapterContent\"}},[_c('el-form-item',[_c('el-input',{staticClass:\"context\",attrs:{\"type\":\"textarea\",\"rows\":15},model:{value:(_vm.ruleForm.chapterContent),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterContent\", $$v)},expression:\"ruleForm.chapterContent\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"prop\":\"authorWords\"}},[_c('el-input',{staticClass:\"authorSay-wrap\",attrs:{\"type\":\"textarea\",\"placeholder\":\"作者的话（不可超过100字）\"},model:{value:(_vm.ruleForm.authorWords),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"authorWords\", $$v)},expression:\"ruleForm.authorWords\"}})],1),_vm._v(\" \"),_c('span',{staticClass:\"words\"},[_vm._v(\"共 \"+_vm._s(_vm.length)+\" 字\")])],1),_vm._v(\" \"),_c('el-form-item',{staticStyle:{\"margin-top\":\"50px\"},attrs:{\"label-width\":_vm.labelWidth,\"label\":\"发布时间\",\"prop\":\"releaseTime\"}},[_c('el-col',{attrs:{\"span\":12}},[_c('el-date-picker',{attrs:{\"type\":\"datetime\",\"disabled\":!_vm.isAutoPublish,\"placeholder\":\"选择时间\"},model:{value:(_vm.ruleForm.releaseTime),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"releaseTime\", $$v)},expression:\"ruleForm.releaseTime\"}}),_vm._v(\" \"),_c('el-checkbox',{staticClass:\"ml20\",attrs:{\"label\":\"定时发布\"},on:{\"change\":function($event){_vm.ruleForm.releaseTime=_vm.isAutoPublish?_vm.ruleForm.releaseTime:''}},model:{value:(_vm.isAutoPublish),callback:function ($$v) {_vm.isAutoPublish=$$v},expression:\"isAutoPublish\"}})],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label-width\":_vm.labelWidth,\"label\":\"是否VIP\",\"prop\":\"chapterIsvip\"}},[_c('el-radio',{staticClass:\"radio\",attrs:{\"label\":0},model:{value:(_vm.ruleForm.chapterIsvip),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterIsvip\", $$v)},expression:\"ruleForm.chapterIsvip\"}},[_vm._v(\"普通\")]),_vm._v(\" \"),(_vm.isVip===2)?_c('el-radio',{staticClass:\"radio\",attrs:{\"label\":1},model:{value:(_vm.ruleForm.chapterIsvip),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"chapterIsvip\", $$v)},expression:\"ruleForm.chapterIsvip\"}},[_vm._v(\"VIP\")]):_vm._e()],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"tc\",staticStyle:{\"width\":\"820px\"},attrs:{\"label-width\":_vm.labelWidth}},[_c('el-button',{staticClass:\"fl\",attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.submitForm('create')}}},[_vm._v(\"立即创建\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"fr save-draft\",on:{\"click\":function($event){_vm.submitForm('draft')}}},[_vm._v(\"保存草稿\")])],1)],1)],1),_vm._v(\" \"),_c('el-dialog',{staticClass:\"alertDialog\",attrs:{\"top\":\"45%\",\"title\":\"新增分卷\",\"visible\":_vm.dialogFormVisible},on:{\"open\":function($event){_vm.volumeForm.volumeName=''},\"update:visible\":function($event){_vm.dialogFormVisible=$event}}},[_c('el-form',{ref:\"volumeForm\",attrs:{\"model\":_vm.volumeForm,\"rules\":_vm.rule,\"label-position\":\"left\"}},[_c('el-form-item',{attrs:{\"label\":\"分卷名称\",\"prop\":\"volumeName\",\"label-width\":'80px'}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.volumeForm.volumeName),callback:function ($$v) {_vm.$set(_vm.volumeForm, \"volumeName\", $$v)},expression:\"volumeForm.volumeName\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogFormVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.addNewVolume('volumeForm')}}},[_vm._v(\"确 定\")])],1)],1)],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-6f249c6b\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/book/add_new_chapter.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}