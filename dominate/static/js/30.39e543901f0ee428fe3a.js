webpackJsonp([30],{kufp:function(e,t){},wk1I:function(e,t,i){"use strict";function o(e){i("kufp")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){for(var t=1,i=arguments.length;t<i;t++){var o=arguments[t]||{};for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];void 0!==s&&(e[a]=s)}}return e},s={name:"ElForm",componentName:"ElForm",provide:function(){return{elForm:this}},props:{model:Object,rules:Object,labelPosition:String,labelWidth:String,labelSuffix:{type:String,default:""},inline:Boolean,inlineMessage:Boolean,statusIcon:Boolean,showMessage:{type:Boolean,default:!0},size:String,disabled:Boolean,validateOnRuleChange:{type:Boolean,default:!0}},watch:{rules:function(){this.validateOnRuleChange&&this.validate(function(){})}},data:function(){return{fields:[]}},created:function(){var e=this;this.$on("el.form.addField",function(t){t&&e.fields.push(t)}),this.$on("el.form.removeField",function(t){t.prop&&e.fields.splice(e.fields.indexOf(t),1)})},methods:{resetFields:function(){this.model&&this.fields.forEach(function(e){e.resetField()})},clearValidate:function(){this.fields.forEach(function(e){e.clearValidate()})},validate:function(e){var t=this;if(!this.model)return void console.warn("[Element Warn][Form]model is required for validate to work!");var i=void 0;"function"!=typeof e&&window.Promise&&(i=new window.Promise(function(t,i){e=function(e){e?t(e):i(e)}}));var o=!0,s=0;0===this.fields.length&&e&&e(!0);var l={};return this.fields.forEach(function(i){i.validate("",function(i,n){i&&(o=!1),l=a({},l,n),"function"==typeof e&&++s===t.fields.length&&e(o,l)})}),i||void 0},validateField:function(e,t){var i=this.fields.filter(function(t){return t.prop===e})[0];if(!i)throw new Error("must call validateField with valid prop string!");i.validate("",t)}}},l=function(){var e=this,t=e.$createElement;return(e._self._c||t)("form",{staticClass:"el-form",class:[e.labelPosition?"el-form--label-"+e.labelPosition:"",{"el-form--inline":e.inline}]},[e._t("default")],2)},n=[],r=i("18Nq"),c=Object(r.a)(s,l,n,!1,null,null,null),d=c.exports,u={components:{ElForm:d},data:function(){return{custom:!1,currentType:"",typeList:[],searchValue:"",tableList:[],dialogFormVisible:!1,formValue:{},restaurant:[],timeout:null,dialogImageUrl:"",dialogVisible:!1}},methods:{getRecommendList:function(){var e=this;this.$ajax("/sys-getRecommendedPosition",{},function(t){200===t.returnCode&&(e.typeList=t.data)})},getActivesRecommend:function(){var e=this;this.$ajax("/admin/sys-getActivityRecommendedPosition",function(t){200===t.returnCode&&(e.tableList=t.data.app.concat(t.data.pc))})},handleClick:function(e,t){var i=this;this.formValue={},this.$set(this.formValue,"showHide",e.showHide),this.$set(this.formValue,"id",e.id),this.$set(this.formValue,"diaType",t),"small"===t?this.$set(this.formValue,"activityImgURL",""):this.$set(this.formValue,"detailsImgAndPageURL",""),this.$nextTick(function(){i.dialogFormVisible=!0})},handleCommand:function(e,t){var i=this;this.$ajax("/admin/HDupdateActivityRecommendedPosition",{id:t.id,showHide:t.showHide?0:1},function(e){200===e.returnCode&&(i.$message({message:e.msg,type:"success"}),i.getActivesRecommend())})},editActiveRecommend:function(){var e=this,t=function(){delete e.formValue.diaType,e.$ajax("/admin/HDupdateActivityRecommendedPosition",e.formValue,function(t){e.dialogFormVisible=!1,200===t.returnCode&&(e.$message({message:t.msg,type:"success"}),e.getActivesRecommend())})};if("small"===this.formValue.diaType)this.formValue.activityImgURL?t():this.$message({message:"请先上传图片",type:"warning"});else if(this.custom){if(!this.formValue.bookId)return this.$message({message:"请填写书籍ID",type:"warning"}),!1;t()}else this.formValue.detailsImgAndPageURL?t():this.$message({message:"请先上传图片",type:"warning"})},onUploading:function(){this.$loading({lock:!0,text:"图片上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},beforeClose:function(){this.custom=!1,this.dialogFormVisible=!1},handlePictureCard:function(e,t){},successBack:function(e,t,i){this.$loading().close(),200===e.returnCode&&("small"===this.formValue.diaType?this.formValue.activityImgURL=e.data:this.formValue.detailsImgAndPageURL=e.data,this.$message({message:"上传成功",type:"success"}))}},created:function(){this.getActivesRecommend()},watch:{searchValue:function(){this.search()}}},m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"book-recommend-actives"},[i("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[i("div",[i("p",[e._v("此表为本站活动推荐位，通过编辑即可修改相应的推荐位信息")]),e._v(" "),i("p",{staticClass:"tip"},[i("span",{staticClass:"red"},[e._v("操作提示：")]),e._v("\n        推荐小图为App或网站首页展示\n      ")])])]),e._v(" "),i("el-row",{staticClass:"mbt20",attrs:{gutter:10}},[i("el-col",{attrs:{xs:18,sm:12,md:9,lg:6,xl:3}}),e._v(" "),i("el-button",{staticClass:"fr",on:{click:function(t){e.$clearCache()}}},[e._v("清除缓存")])],1),e._v(" "),i("el-row",[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableList,border:"",select:"row","tooltip-effect":"dark"}},[i("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"id",label:"Id",width:"34",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:"终端",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.type?"PC":"App")+"\n        ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"小图",align:"center",minWidth:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("img",{staticClass:"mw-auto",attrs:{src:t.row.activityImgURL,alt:""},on:{click:function(i){e.handleClick(t.row,"small")}}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"大图",minWidth:"400",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"img-wrap",on:{click:function(i){e.handleClick(t.row,"big")}}},[t.row.bookId?i("span",[e._v(e._s(t.row.bookId))]):[i("img",{staticClass:"active-big-img mw-auto",attrs:{src:t.row.detailsImgAndPageURL,alt:""}})]],2)]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"详情链接",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-dropdown",{attrs:{size:"medium",trigger:"click"},on:{command:function(i){e.handleCommand(i,t.row)}}},[i("a",{staticClass:"el-dropdown-link",attrs:{href:"javascript:0;"}},[t.row.showHide?i("span",{staticClass:"green"},[e._v("隐藏")]):i("span",{staticClass:"red"},[e._v("显示")])]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[e._v(e._s(t.row.showHide?"显示":"隐藏"))])],1)],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n         "+e._s(e._f("time")(t.row.dateTime,"long"))+"\n        ")]}}])})],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"修改推荐位",width:"420px","before-close":e.beforeClose,"close-on-press-escape":!1,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")]),e._v(" "),i("el-form",[i("el-form-item",["big"==e.formValue.diaType&&!e.custom||"small"==e.formValue.diaType?i("el-upload",{ref:"upload",attrs:{name:"file",listType:"picture","show-file-list":!1,"on-change":e.handlePictureCard,"on-progress":e.onUploading,"on-success":e.successBack,"on-error":e.successBack,action:"/api/admin/uploadActivityRecommendedPositionImg","auto-upload":!0}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(e._s("small"===e.formValue.diaType?"上传小图":"上传大图"))]),e._v(" "),"big"!=e.formValue.diaType||e.custom?e._e():i("a",{attrs:{href:"javascript:0;"},on:{click:function(t){e.custom=!0}}},[e._v("添加书籍ID")])],1):e._e()],1),e._v(" "),e.custom?i("el-form-item",{attrs:{labelWidth:"90px",label:"添加书籍ID"}},[i("el-input",{attrs:{type:"text"},model:{value:e.formValue.bookId,callback:function(t){e.$set(e.formValue,"bookId",t)},expression:"formValue.bookId"}})],1):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editActiveRecommend(e.formValue.diaType)}}},[e._v("更新")])],1)],1)],1)},f=[],p=o,h=Object(r.a)(u,m,f,!1,p,null,null);t.default=h.exports}});
//# sourceMappingURL=30.39e543901f0ee428fe3a.js.map