webpackJsonp([52],{AKa3:function(e,t,o){"use strict";function a(e){o("QkZZ")}Object.defineProperty(t,"__esModule",{value:!0});var l={data:function(){var e=this;return{dialogType:"add",bookInfo:{},centerDialogVisible:!1,volumeList:[],subData:{volumeName:"",bookName:"",bookid:""},page:1,multipleSelection:[],rules:{volumeName:[{validator:function(t,o,a){return e.$http.trim(o).length?a():a(new Error("请填写分卷名"))},trigger:"blur"}],volumeOrder:[{required:!0,type:"number",message:"卷序列号不能为空"},{type:"number",message:"序列号必须为数字"}]}}},methods:{getBookInfo:function(){var e=this;this.$ajax("/book-showBookInfo",{bookid:this.$route.params.bid},function(t){200===t.returnCode&&(e.bookInfo=t.data,e.getVolumeList())})},getVolumeList:function(){var e=this;this.$ajax("/books-getvolume",{bookId:this.$route.params.bid},function(t){200===t.returnCode&&(e.volumeList=t.data)})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){return t.subData.volumeName=t.$http.trim(t.subData.volumeName),Math.floor(t.subData.volumeOrder)<1||t.subData.volumeOrder!==Math.floor(t.subData.volumeOrder)?(t.$message({message:"序列号必须用大于0的正整数！",type:"error"}),!1):e?void("edit"===t.dialogType?t.$ajax("/books-updatevolume",t.subData,function(e){t.centerDialogVisible=!1,200===e.returnCode&&(t.getVolumeList(),t.$message({message:"修改成功",type:"success"}))}):t.$ajax("/books-getCheckVolume",{bookid:t.subData.bookid,volumeName:t.subData.volumeName},function(e){200===e.returnCode?t.$ajax("/books-addvolume",t.subData,function(e){t.centerDialogVisible=!1,200===e.returnCode&&(t.getVolumeList(),t.$message({message:"创建成功！",type:"success"}))}):t.centerDialogVisible=!1})):(t.$message({message:"请完善信息后提交！",type:"warning"}),!1)})},handleVolume:function(e,t){this.dialogType=e,this.centerDialogVisible=!0,this.subData=t||{volumeName:"",bookName:this.bookInfo.bookName,bookid:this.bookInfo.bookId,volumeOrder:this.maxOrder+1}},handleDelete:function(e){var t=this;this.$ajax("/books-deletevolume",{volumeId:e.id},function(e){200===e.returnCode&&(t.getVolumeList(),t.$message({message:"删除成功",type:"success"}))})}},created:function(){this.getBookInfo()},watch:{$route:function(){this.getVolumeList()}},computed:{maxOrder:function(){var e=[];return this.volumeList.forEach(function(t){e.push(t.volumeOrder)}),Math.max.apply(null,e)}}},i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"book-volume-list-wrap"},[o("el-alert",{attrs:{title:"操作说明",type:"info",description:"分卷顺序默认按照序列号的大小依次排列，修改卷序列号时请使用连续的数字","show-icon":""}}),e._v(" "),o("el-row",{staticClass:"mbt20"},[o("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.handleVolume("add")}}},[e._v("新建分卷")])],1),e._v(" "),o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.volumeList,border:""}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"40"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"id",label:"ID",width:"50"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bookName","show-overflow-tooltip":!0,label:"书名",width:"200"}}),e._v(" "),o("el-table-column",{attrs:{prop:"volumeName","show-overflow-tooltip":!0,label:"分卷名"}}),e._v(" "),o("el-table-column",{attrs:{prop:"volumeOrder",align:"center",label:"序列号",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.handleVolume("edit",t.row)}}},[e._v("编辑")]),e._v(" "),o("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(o){e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),o("el-dialog",{staticClass:"alertDialog",attrs:{title:"add"==e.dialogType?"新建分卷":"编辑分卷",visible:e.centerDialogVisible,top:"45vh",width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[o("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.subData,rules:e.rules}},[o("el-form-item",{attrs:{prop:"volumeName"}},[o("el-input",{attrs:{type:"text",placeholder:"请输入分卷名"},model:{value:e.subData.volumeName,callback:function(t){e.$set(e.subData,"volumeName",t)},expression:"subData.volumeName"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"volumeOrder"}},[o("el-input",{attrs:{type:"text",disabled:"add"==e.dialogType,placeholder:"请输卷序列"},model:{value:e.subData.volumeOrder,callback:function(t){e.$set(e.subData,"volumeOrder",e._n(t))},expression:"subData.volumeOrder"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)},s=[],r=o("18Nq"),u=a,n=Object(r.a)(l,i,s,!1,u,null,null);t.default=n.exports},QkZZ:function(e,t){}});
//# sourceMappingURL=52.a0744183a99a10112d18.js.map