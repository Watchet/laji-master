webpackJsonp([29],{PcA9:function(e,t,a){"use strict";function i(e){a("QPca")}Object.defineProperty(t,"__esModule",{value:!0});var l=a("3cXf"),o=a.n(l),n={data:function(){return{deadLineList:[],dialogFormVisible:!1,selectValue:"",formValue:{list:[]},options:[],loading:!1}},methods:{getDeadLine:function(e){var t=this;this.$ajax("/admin/sys-getFreetimelimit",{page:e||this.$route.params.page},function(e){200===e.returnCode&&(e.data.list=e.data.list.reverse(),t.deadLineList=e.data)})},editDeadLine:function(){var e=this,t=0,a=void 0;this.formValue.time?8!==this.formValue.list.length?this.$message({message:"请添加满8本书籍后提交",type:"warning"}):(this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),a=JSON.parse(o()(this.formValue.list)),function i(l){e.$ajax("/admin/sys-addfreetimelimit",{bookId:l[0],bookName:l[1],batchNumber:e.deadLineList.list?e.deadLineList.list[0].batchNumber+1:1,refreshtime:e.formValue.time},function(l){if(200===l.returnCode){if(7===t)return e.dialogFormVisible=!1,e.$loading().close(),e.getDeadLine(),e.$message({message:"添加成功",type:"success"}),!1;t++,t<=7&&i(a[t].split(","))}})}(a[0].split(","))):this.$message({message:"请先选取时间",type:"warning"})},delDeadLine:function(e){var t=this;if(!e){for(var a=[],i=0,l=this.deadLineList.list.length;i<l;i++){if(this.deadLineList.list[0].batchNumber!==this.deadLineList.list[i].batchNumber)return this.$message({message:"不同批次，不可一次删除",type:"warning"}),!1;a.push(this.deadLineList.list[i].id)}e=a.toString()}this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$ajax("/admin/sys-deltefreetimelimit",{freeTimeLimitid:e},function(e){200===e.returnCode&&(t.$message({message:"删除成功",type:"success"}),t.getDeadLine(1))})})},remoteMethod:function(e){var t=this;""!==e?(this.loading=!0,this.$ajax("/stacks-search",{keyWord:e,isHotWorld:1,startPage:1},function(a){200===a.returnCode&&(t.loading=!1,t.options=a.data.list.filter(function(t){return t.bookName.toLowerCase().indexOf(e.toLowerCase())>-1}))})):this.options=[]},addDeadLine:function(){1!==this.$route.params.page&&this.$router.push({params:{page:1}}),this.dialogFormVisible=!0},search:function(){},pageChange:function(e){this.$router.push({params:{page:e}})}},created:function(){this.getDeadLine()},watch:{$route:function(){this.getDeadLine()}},computed:{time:function(){var e=new Date;return e.setFullYear(e.getFullYear()+10)+"  -   "+e}}},s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[a("div",[a("p",[e._v("\n        限时免费按照批次更新，每批固定8本书籍，每批次的限免时长为上一批次截止时间到本批次截止时间；设置当前批次截止时间时必须大于上一批次的截止时间\n      ")])])]),e._v(" "),a("el-row",{staticClass:"mbt20"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.addDeadLine}},[e._v("添加")]),e._v(" "),a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(t){e.delDeadLine()}}},[e._v("删除本批")]),e._v(" "),a("el-button",{staticClass:"fr",on:{click:function(t){e.$clearCache()}}},[e._v("清除缓存")])],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.deadLineList.list,border:"",select:"row","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"批次",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("第"+e._s(t.row.batchNumber+1)+"批")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"bookId",label:"书ID",width:"60",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"bookName",label:"书名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"writerName",label:"作者"}}),e._v(" "),a("el-table-column",{attrs:{label:"截止时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("time")(t.row.refreshtime,"long")))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"书籍封面"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"bookCover",attrs:{src:e.row.bookImage,alt:e.row.bookName}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-row",[a("a",{attrs:{href:"javascript:0;"}},[e._v("编辑")]),e._v(" "),a("a",{staticClass:"red",attrs:{href:"javascript:0;"},on:{click:function(a){e.delDeadLine(t.row.id)}}},[e._v("删除")])])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.deadLineList.pageNum,"page-size":e.deadLineList.pageSize,layout:"prev, pager, next",total:e.deadLineList.total},on:{"current-change":e.pageChange,"update:currentPage":function(t){e.$set(e.deadLineList,"pageNum",t)}}}),e._v(" "),a("el-dialog",{staticClass:"alertDialog",attrs:{title:"修改限时免费",width:"420px","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{labelWidth:"80px"}},[a("el-form-item",{attrs:{label:"截止时间",prop:"time"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:00:00",type:"datetime",placeholder:"选择日期时间"},model:{value:e.formValue.time,callback:function(t){e.$set(e.formValue,"time",t)},expression:"formValue.time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"书籍名称"}},[a("el-select",{attrs:{multiple:"","multiple-limit":8,filterable:"",remote:"",placeholder:"请输入关键词","filter-method":e.search,"remote-method":e.remoteMethod,loading:e.loading},model:{value:e.formValue.list,callback:function(t){e.$set(e.formValue,"list",t)},expression:"formValue.list"}},e._l(e.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.bookName,value:e.bookId+","+e.bookName}})}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.editDeadLine}},[e._v("确 定")])],1)],1)],1)},r=[],c=a("18Nq"),d=i,u=Object(c.a)(n,s,r,!1,d,null,null);t.default=u.exports},QPca:function(e,t){}});
//# sourceMappingURL=29.b0760c6318d1e236e0c3.js.map