{"version":3,"sources":["webpack:///static/js/29.b0760c6318d1e236e0c3.js","webpack:///./src/components/system/deadline.vue","webpack:///src/components/system/deadline.vue","webpack:///./src/components/system/deadline.vue?4cf6"],"names":["webpackJsonp","PcA9","module","__webpack_exports__","__webpack_require__","injectStyle","context","Object","defineProperty","value","stringify","stringify_default","n","deadline","data","deadLineList","dialogFormVisible","selectValue","formValue","list","options","loading","methods","getDeadLine","page","_this","this","$ajax","$route","params","res","returnCode","reverse","editDeadLine","_this2","num","subData","time","length","$message","message","type","$loading","lock","text","spinner","background","JSON","parse","add","arr","bookId","bookName","batchNumber","refreshtime","close","split","delDeadLine","id","_this3","k","len","push","toString","$confirm","confirmButtonText","cancelButtonText","then","freeTimeLimitid","remoteMethod","query","_this4","keyWord","isHotWorld","startPage","filter","item","toLowerCase","indexOf","addDeadLine","$router","search","pageChange","created","watch","computed","now","Date","setFullYear","getFullYear","render","_vm","_h","$createElement","_c","_self","attrs","title","show-icon","_v","staticClass","plain","on","click","$event","$clearCache","ref","staticStyle","width","border","select","tooltip-effect","align","label","scopedSlots","_u","key","fn","scope","_s","row","prop","_f","src","bookImage","alt","href","current-page","pageNum","page-size","pageSize","layout","total","current-change","update:currentPage","$set","close-on-click-modal","close-on-press-escape","visible","update:visible","labelWidth","value-format","placeholder","model","callback","$$v","expression","multiple","multiple-limit","filterable","remote","filter-method","remote-method","_l","$index","slot","staticRenderFns","component_normalizer","__vue_styles__","Component","QPca","exports"],"mappings":"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","file":"static/js/29.b0760c6318d1e236e0c3.js","sourcesContent":["webpackJsonp([29],{\n\n/***/ \"PcA9\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\nvar stringify = __webpack_require__(\"3cXf\");\nvar stringify_default = /*#__PURE__*/__webpack_require__.n(stringify);\n\n// CONCATENATED MODULE: ./node_modules/_babel-loader@7.1.4@babel-loader/lib!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=script&index=0!./src/components/system/deadline.vue\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* harmony default export */ var deadline = ({\n  data: function data() {\n    return {\n      deadLineList: [],\n      dialogFormVisible: false,\n      selectValue: '',\n      formValue: {\n        list: []\n      },\n      options: [],\n      loading: false\n    };\n  },\n\n  methods: {\n    getDeadLine: function getDeadLine(page) {\n      var _this = this;\n\n      this.$ajax('/admin/sys-getFreetimelimit', { page: page || this.$route.params.page }, function (res) {\n        if (res.returnCode === 200) {\n          res.data.list = res.data.list.reverse();\n          _this.deadLineList = res.data;\n        }\n      });\n    },\n    editDeadLine: function editDeadLine() {\n      var _this2 = this;\n\n      var num = 0,\n          subData = void 0;\n      var add = function add(arr) {\n        _this2.$ajax('/admin/sys-addfreetimelimit', {\n          bookId: arr[0],\n          bookName: arr[1],\n          batchNumber: _this2.deadLineList.list ? _this2.deadLineList.list[0].batchNumber + 1 : 1,\n          refreshtime: _this2.formValue.time\n        }, function (res) {\n          if (res.returnCode === 200) {\n            if (num === 7) {\n              _this2.dialogFormVisible = false;\n              _this2.$loading().close();\n              _this2.getDeadLine();\n              _this2.$message({ message: '添加成功', type: 'success' });\n              return false;\n            }\n            num++;\n            if (num <= 7) {\n              add(subData[num].split(','));\n            }\n          }\n        });\n      };\n      if (this.formValue.time) {\n        if (this.formValue.list.length !== 8) {\n          this.$message({ message: '请添加满8本书籍后提交', type: 'warning' });\n        } else {\n          this.$loading({\n            lock: true,\n            text: 'Loading',\n            spinner: 'el-icon-loading',\n            background: 'rgba(0, 0, 0, 0.7)'\n          });\n          subData = JSON.parse(stringify_default()(this.formValue.list));\n          add(subData[0].split(','));\n        }\n      } else {\n        this.$message({ message: '请先选取时间', type: 'warning' });\n      }\n    },\n    delDeadLine: function delDeadLine(id) {\n      var _this3 = this;\n\n      if (!id) {\n        var list = [];\n        for (var k = 0, len = this.deadLineList.list.length; k < len; k++) {\n          if (this.deadLineList.list[0].batchNumber !== this.deadLineList.list[k].batchNumber) {\n            this.$message({ message: '不同批次，不可一次删除', type: 'warning' });\n            return false;\n          }\n          list.push(this.deadLineList.list[k].id);\n        }\n        id = list.toString();\n      }\n      this.$confirm('此操作将永久删除该数据, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this3.$ajax('/admin/sys-deltefreetimelimit', {\n          freeTimeLimitid: id\n        }, function (res) {\n          if (res.returnCode === 200) {\n            _this3.$message({ message: '删除成功', type: 'success' });\n            _this3.getDeadLine(1);\n          }\n        });\n      });\n    },\n    remoteMethod: function remoteMethod(query) {\n      var _this4 = this;\n\n      if (query !== '') {\n        this.loading = true;\n        this.$ajax('/stacks-search', {\n          keyWord: query,\n          isHotWorld: 1,\n          startPage: 1\n        }, function (res) {\n          if (res.returnCode === 200) {\n            _this4.loading = false;\n            _this4.options = res.data.list.filter(function (item) {\n              return item.bookName.toLowerCase().indexOf(query.toLowerCase()) > -1;\n            });\n          }\n        });\n      } else {\n        this.options = [];\n      }\n    },\n    addDeadLine: function addDeadLine() {\n      if (this.$route.params.page !== 1) {\n        this.$router.push({ params: { page: 1 } });\n      }\n      this.dialogFormVisible = true;\n    },\n    search: function search() {\n      //   console.log(\"搜索\")\n    },\n    pageChange: function pageChange(page) {\n      this.$router.push({ params: { page: page } });\n    }\n  },\n  created: function created() {\n    this.getDeadLine();\n  },\n\n  watch: {\n    '$route': function $route() {\n      this.getDeadLine();\n    }\n  },\n  computed: {\n    time: function time() {\n      var now = new Date();\n      var fut = now.setFullYear(now.getFullYear() + 10);\n      return fut + '  -   ' + now;\n    }\n  }\n});\n// CONCATENATED MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-5143ac07\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/system/deadline.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-alert',{attrs:{\"title\":\"操作说明\",\"type\":\"info\",\"show-icon\":\"\"}},[_c('div',[_c('p',[_vm._v(\"\\n        限时免费按照批次更新，每批固定8本书籍，每批次的限免时长为上一批次截止时间到本批次截止时间；设置当前批次截止时间时必须大于上一批次的截止时间\\n      \")])])]),_vm._v(\" \"),_c('el-row',{staticClass:\"mbt20\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"plain\":\"\"},on:{\"click\":_vm.addDeadLine}},[_vm._v(\"添加\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"danger\",\"plain\":\"\"},on:{\"click\":function($event){_vm.delDeadLine()}}},[_vm._v(\"删除本批\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"fr\",on:{\"click\":function($event){_vm.$clearCache()}}},[_vm._v(\"清除缓存\")])],1),_vm._v(\" \"),_c('el-table',{ref:\"multipleTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.deadLineList.list,\"border\":\"\",\"select\":\"row\",\"tooltip-effect\":\"dark\"}},[_c('el-table-column',{attrs:{\"type\":\"selection\",\"align\":\"center\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"批次\",\"width\":\"60\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',[_vm._v(\"第\"+_vm._s(scope.row.batchNumber+1)+\"批\")])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"bookId\",\"label\":\"书ID\",\"width\":\"60\",\"align\":\"center\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"bookName\",\"label\":\"书名\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"writerName\",\"label\":\"作者\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"截止时间\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',[_vm._v(_vm._s(_vm._f(\"time\")(scope.row.refreshtime,'long')))])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"label\":\"书籍封面\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('img',{staticClass:\"bookCover\",attrs:{\"src\":scope.row.bookImage,\"alt\":scope.row.bookName}})]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-row',[_c('a',{attrs:{\"href\":\"javascript:0;\"}},[_vm._v(\"编辑\")]),_vm._v(\" \"),_c('a',{staticClass:\"red\",attrs:{\"href\":\"javascript:0;\"},on:{\"click\":function($event){_vm.delDeadLine(scope.row.id)}}},[_vm._v(\"删除\")])])]}}])})],1),_vm._v(\" \"),_c('el-pagination',{attrs:{\"background\":\"\",\"current-page\":_vm.deadLineList.pageNum,\"page-size\":_vm.deadLineList.pageSize,\"layout\":\"prev, pager, next\",\"total\":_vm.deadLineList.total},on:{\"current-change\":_vm.pageChange,\"update:currentPage\":function($event){_vm.$set(_vm.deadLineList, \"pageNum\", $event)}}}),_vm._v(\" \"),_c('el-dialog',{staticClass:\"alertDialog\",attrs:{\"title\":\"修改限时免费\",\"width\":\"420px\",\"close-on-click-modal\":false,\"close-on-press-escape\":false,\"visible\":_vm.dialogFormVisible},on:{\"update:visible\":function($event){_vm.dialogFormVisible=$event}}},[_c('el-form',{attrs:{\"labelWidth\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"截止时间\",\"prop\":\"time\"}},[_c('el-date-picker',{attrs:{\"value-format\":\"yyyy-MM-dd HH:00:00\",\"type\":\"datetime\",\"placeholder\":\"选择日期时间\"},model:{value:(_vm.formValue.time),callback:function ($$v) {_vm.$set(_vm.formValue, \"time\", $$v)},expression:\"formValue.time\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"书籍名称\"}},[_c('el-select',{attrs:{\"multiple\":\"\",\"multiple-limit\":8,\"filterable\":\"\",\"remote\":\"\",\"placeholder\":\"请输入关键词\",\"filter-method\":_vm.search,\"remote-method\":_vm.remoteMethod,\"loading\":_vm.loading},model:{value:(_vm.formValue.list),callback:function ($$v) {_vm.$set(_vm.formValue, \"list\", $$v)},expression:\"formValue.list\"}},_vm._l((_vm.options),function(item,$index){return _c('el-option',{key:$index,attrs:{\"label\":item.bookName,\"value\":item.bookId+','+item.bookName}})}))],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogFormVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.editDeadLine}},[_vm._v(\"确 定\")])],1)],1)],1)}\nvar staticRenderFns = []\n\n// EXTERNAL MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer.js\nvar component_normalizer = __webpack_require__(\"18Nq\");\n\n// CONCATENATED MODULE: ./src/components/system/deadline.vue\nfunction injectStyle (context) {\n  __webpack_require__(\"QPca\")\n}\n/* script */\n\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\n\nvar Component = Object(component_normalizer[\"a\" /* default */])(\n  deadline,\n  render,\n  staticRenderFns,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var system_deadline = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"QPca\":\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/29.b0760c6318d1e236e0c3.js","function injectStyle (context) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=styles&index=0!./deadline.vue\")\n}\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./deadline.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./deadline.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5143ac07\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=template&index=0!./deadline.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/system/deadline.vue\n// module id = null\n// module chunks = ","<template>\n    <div>\n      <el-alert\n        title=\"操作说明\"\n        type=\"info\"\n        show-icon>\n        <div>\n          <p>\n            限时免费按照批次更新，每批固定8本书籍，每批次的限免时长为上一批次截止时间到本批次截止时间；设置当前批次截止时间时必须大于上一批次的截止时间\n          </p>\n        </div>\n      </el-alert>\n      <el-row class=\"mbt20\">\n        <el-button type=\"primary\" plain @click=\"addDeadLine\">添加</el-button>\n        <el-button type=\"danger\" plain @click=\"delDeadLine()\">删除本批</el-button>\n        <el-button class=\"fr\" @click=\"$clearCache()\">清除缓存</el-button>\n      </el-row>\n      <el-table\n        ref=\"multipleTable\"\n        :data=\"deadLineList.list\"\n        border\n        select=\"row\"\n        tooltip-effect=\"dark\"\n        style=\"width: 100%\">\n        <el-table-column\n          type=\"selection\"\n          align=\"center\">\n        </el-table-column>\n        \n        <el-table-column\n          label=\"批次\"\n          width=\"60\"\n          align=\"center\"\n        >\n          <template slot-scope=\"scope\">\n            <span>第{{scope.row.batchNumber+1}}批</span>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          prop=\"bookId\"\n          label=\"书ID\"\n          width=\"60\"\n          align=\"center\">\n        </el-table-column>\n        \n        <el-table-column\n          prop=\"bookName\"\n          label=\"书名\"\n        >\n        </el-table-column>\n        \n        <el-table-column\n          prop=\"writerName\"\n          label=\"作者\"\n        >\n        </el-table-column>\n  \n        <el-table-column\n          label=\"截止时间\"\n          align=\"center\"\n        >\n          <template slot-scope=\"scope\">\n            <span>{{scope.row.refreshtime | time('long')}}</span>\n          </template>\n        </el-table-column>\n        \n        <el-table-column\n          align=\"center\"\n          label=\"书籍封面\"\n        >\n          <template slot-scope=\"scope\">\n            <img class=\"bookCover\" :src=\"scope.row.bookImage\" :alt=\"scope.row.bookName\">\n          </template>\n        </el-table-column>\n        <el-table-column\n          label=\"操作\"\n          align=\"center\">\n          <template slot-scope=\"scope\">\n            <el-row >\n              <a href=\"javascript:0;\">编辑</a>\n              <a href=\"javascript:0;\" class=\"red\" @click=\"delDeadLine(scope.row.id)\">删除</a>\n            </el-row>\n          </template>\n        </el-table-column>\n      </el-table>\n      \n      <el-pagination\n        background\n        @current-change=\"pageChange\"\n        :current-page.sync=\"deadLineList.pageNum\"\n        :page-size=\"deadLineList.pageSize\"\n        layout=\"prev, pager, next\"\n        :total=\"deadLineList.total\">\n      </el-pagination>\n      \n      <el-dialog\n        title=\"修改限时免费\"\n        class=\"alertDialog\"\n        width=\"420px\"\n        :close-on-click-modal=\"false\"\n        :close-on-press-escape=\"false\"\n        :visible.sync=\"dialogFormVisible\">\n        <el-form labelWidth=\"80px\">\n          <el-form-item label=\"截止时间\" prop=\"time\">\n            <el-date-picker\n              v-model=\"formValue.time\"\n              value-format=\"yyyy-MM-dd HH:00:00\"\n              type=\"datetime\"\n              placeholder=\"选择日期时间\">\n            </el-date-picker>\n          </el-form-item>\n          <el-form-item label=\"书籍名称\">\n            <el-select\n              v-model=\"formValue.list\"\n              multiple\n              :multiple-limit=\"8\"\n              filterable\n              remote\n              placeholder=\"请输入关键词\"\n              :filter-method=\"search\"\n              :remote-method=\"remoteMethod\"\n              :loading=\"loading\">\n              <el-option\n                v-for=\"(item,$index) in options\"\n                :key=\"$index\"\n                :label=\"item.bookName\"\n                :value=\"item.bookId+','+item.bookName\">\n              </el-option>\n            </el-select>\n          </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"editDeadLine\">确 定</el-button>\n        </div>\n      </el-dialog>\n    </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\n    export default{\n      data() {\n        return {\n          deadLineList: [],\n          dialogFormVisible: false,\n          selectValue: '',\n          formValue: {\n            list: []\n          },\n          options: [],\n          loading: false\n        }\n      },\n      methods: {\n        getDeadLine(page) {\n          this.$ajax('/admin/sys-getFreetimelimit', { page: page || this.$route.params.page }, res => {\n            if (res.returnCode === 200) {\n              res.data.list = res.data.list.reverse()\n              this.deadLineList = res.data\n            }\n          })\n        },\n        editDeadLine() {\n          let num = 0, subData\n          const add = (arr) => {\n            this.$ajax('/admin/sys-addfreetimelimit', {\n              bookId: arr[0],\n              bookName: arr[1],\n              batchNumber: this.deadLineList.list ? (this.deadLineList.list[0].batchNumber + 1) : 1,\n              refreshtime: this.formValue.time\n            }, res => {\n              if (res.returnCode === 200) {\n                if (num === 7) {\n                  this.dialogFormVisible = false\n                  this.$loading().close()\n                  this.getDeadLine()\n                  this.$message({ message: '添加成功', type: 'success' })\n                  return false\n                }\n                num++\n                if (num <= 7) {\n                  add(subData[num].split(','))\n                }\n              }\n            })\n          }\n          if (this.formValue.time) {\n            if (this.formValue.list.length !== 8) {\n              this.$message({ message: '请添加满8本书籍后提交', type: 'warning' })\n            } else {\n              this.$loading({\n                lock: true,\n                text: 'Loading',\n                spinner: 'el-icon-loading',\n                background: 'rgba(0, 0, 0, 0.7)'\n              })\n              subData = JSON.parse(JSON.stringify(this.formValue.list))\n              add(subData[0].split(','))\n            }\n          } else {\n            this.$message({ message: '请先选取时间', type: 'warning' })\n          }\n        },\n        delDeadLine(id) {\n          if (!id) {\n            const list = []\n            for (let k = 0, len = this.deadLineList.list.length; k < len; k++) {\n              if (this.deadLineList.list[0].batchNumber !== this.deadLineList.list[k].batchNumber) {\n                this.$message({ message: '不同批次，不可一次删除', type: 'warning' })\n                return false\n              }\n              list.push(this.deadLineList.list[k].id)\n            }\n            id = list.toString()\n          }\n          this.$confirm('此操作将永久删除该数据, 是否继续?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(() => {\n            this.$ajax('/admin/sys-deltefreetimelimit', {\n              freeTimeLimitid: id\n            }, (res) => {\n              if (res.returnCode === 200) {\n                this.$message({ message: '删除成功', type: 'success' })\n                this.getDeadLine(1)\n              }\n            })\n          })\n    },\n        remoteMethod(query) {\n          if (query !== '') {\n            this.loading = true\n            this.$ajax('/stacks-search', {\n              keyWord: query,\n              isHotWorld: 1,\n              startPage: 1\n            }, res => {\n              if (res.returnCode === 200) {\n                this.loading = false\n                this.options = res.data.list.filter(item => {\n                  return item.bookName.toLowerCase().indexOf(query.toLowerCase()) > -1\n                })\n              }\n            })\n          } else {\n            this.options = []\n          }\n        },\n        addDeadLine() {\n          if (this.$route.params.page !== 1) {\n            this.$router.push({ params: { page: 1 }})\n          }\n          this.dialogFormVisible = true\n        },\n        search() {\n        //   console.log(\"搜索\")\n        },\n        pageChange(page) {\n          this.$router.push({ params: { page: page }})\n        }\n      },\n      created() {\n        this.getDeadLine()\n      },\n      watch: {\n        '$route': function() {\n          this.getDeadLine()\n        }\n      },\n      computed: {\n        time: function() {\n          const now = new Date()\n          const fut = now.setFullYear(now.getFullYear() + 10)\n          return fut + '  -   ' + now\n        }\n      }\n    }\n</script>\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\n.el-table\n  .cell\n    .bookCover\n      width 60px\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/system/deadline.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-alert',{attrs:{\"title\":\"操作说明\",\"type\":\"info\",\"show-icon\":\"\"}},[_c('div',[_c('p',[_vm._v(\"\\n        限时免费按照批次更新，每批固定8本书籍，每批次的限免时长为上一批次截止时间到本批次截止时间；设置当前批次截止时间时必须大于上一批次的截止时间\\n      \")])])]),_vm._v(\" \"),_c('el-row',{staticClass:\"mbt20\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"plain\":\"\"},on:{\"click\":_vm.addDeadLine}},[_vm._v(\"添加\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"danger\",\"plain\":\"\"},on:{\"click\":function($event){_vm.delDeadLine()}}},[_vm._v(\"删除本批\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"fr\",on:{\"click\":function($event){_vm.$clearCache()}}},[_vm._v(\"清除缓存\")])],1),_vm._v(\" \"),_c('el-table',{ref:\"multipleTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.deadLineList.list,\"border\":\"\",\"select\":\"row\",\"tooltip-effect\":\"dark\"}},[_c('el-table-column',{attrs:{\"type\":\"selection\",\"align\":\"center\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"批次\",\"width\":\"60\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',[_vm._v(\"第\"+_vm._s(scope.row.batchNumber+1)+\"批\")])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"bookId\",\"label\":\"书ID\",\"width\":\"60\",\"align\":\"center\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"bookName\",\"label\":\"书名\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"writerName\",\"label\":\"作者\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"截止时间\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',[_vm._v(_vm._s(_vm._f(\"time\")(scope.row.refreshtime,'long')))])]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"label\":\"书籍封面\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('img',{staticClass:\"bookCover\",attrs:{\"src\":scope.row.bookImage,\"alt\":scope.row.bookName}})]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-row',[_c('a',{attrs:{\"href\":\"javascript:0;\"}},[_vm._v(\"编辑\")]),_vm._v(\" \"),_c('a',{staticClass:\"red\",attrs:{\"href\":\"javascript:0;\"},on:{\"click\":function($event){_vm.delDeadLine(scope.row.id)}}},[_vm._v(\"删除\")])])]}}])})],1),_vm._v(\" \"),_c('el-pagination',{attrs:{\"background\":\"\",\"current-page\":_vm.deadLineList.pageNum,\"page-size\":_vm.deadLineList.pageSize,\"layout\":\"prev, pager, next\",\"total\":_vm.deadLineList.total},on:{\"current-change\":_vm.pageChange,\"update:currentPage\":function($event){_vm.$set(_vm.deadLineList, \"pageNum\", $event)}}}),_vm._v(\" \"),_c('el-dialog',{staticClass:\"alertDialog\",attrs:{\"title\":\"修改限时免费\",\"width\":\"420px\",\"close-on-click-modal\":false,\"close-on-press-escape\":false,\"visible\":_vm.dialogFormVisible},on:{\"update:visible\":function($event){_vm.dialogFormVisible=$event}}},[_c('el-form',{attrs:{\"labelWidth\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"截止时间\",\"prop\":\"time\"}},[_c('el-date-picker',{attrs:{\"value-format\":\"yyyy-MM-dd HH:00:00\",\"type\":\"datetime\",\"placeholder\":\"选择日期时间\"},model:{value:(_vm.formValue.time),callback:function ($$v) {_vm.$set(_vm.formValue, \"time\", $$v)},expression:\"formValue.time\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"书籍名称\"}},[_c('el-select',{attrs:{\"multiple\":\"\",\"multiple-limit\":8,\"filterable\":\"\",\"remote\":\"\",\"placeholder\":\"请输入关键词\",\"filter-method\":_vm.search,\"remote-method\":_vm.remoteMethod,\"loading\":_vm.loading},model:{value:(_vm.formValue.list),callback:function ($$v) {_vm.$set(_vm.formValue, \"list\", $$v)},expression:\"formValue.list\"}},_vm._l((_vm.options),function(item,$index){return _c('el-option',{key:$index,attrs:{\"label\":item.bookName,\"value\":item.bookId+','+item.bookName}})}))],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogFormVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.editDeadLine}},[_vm._v(\"确 定\")])],1)],1)],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-5143ac07\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/system/deadline.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}