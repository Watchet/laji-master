{"version":3,"sources":["webpack:///static/js/58.147f970b4b190a20480f.js","webpack:///./src/components/book/add_new_book.vue","webpack:///src/components/book/add_new_book.vue","webpack:///./src/components/book/add_new_book.vue?3451"],"names":["webpackJsonp","GwdR","module","__webpack_exports__","__webpack_require__","injectStyle","context","Object","defineProperty","value","stringify","stringify_default","n","add_new_book","data","_this","this","fullLoading","activeName","reloading","baseData","userList","selectValue","bookDetail","bookName","writerName","bookWriterId","bookClassificationId","bookLabId","bookAuthorization","bookIntroduction","rules1","required","validator","rule","callback","txt","$http","trim","length","Error","test","$ajax","json","returnCode","message","trigger","type","min","max","methods","onSubmit","formName","_this2","$loading","lock","text","spinner","background","formData","JSON","parse","toString","replace","$refs","validate","valid","res","$nextTick","close","$confirm","confirmButtonText","cancelButtonText","then","$router","push","path","$message","remoteMethod","query","_this3","key","filter","item","pseudonym","toLowerCase","indexOf","getBaseInfo","_this4","getBookDetail","_this5","bookid","$route","params","bid","arr","split","forEach","parseInt","created","watch","bookDetail.bookIntroduction","val","name","id","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","separator-class","_v","to","title","show-icon","ref","rules","model","label-width","label","prop","xs","sm","md","lg","xl","$$v","$set","expression","filterable","remote","loading","remote-method","placeholder","_l","userId","staticStyle","float","_s","$index","classificationName","bookLableName","on","click","$event","staticRenderFns","component_normalizer","__vue_styles__","Component","SAqg","exports"],"mappings":"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","file":"static/js/58.147f970b4b190a20480f.js","sourcesContent":["webpackJsonp([58],{\n\n/***/ \"GwdR\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\nvar stringify = __webpack_require__(\"3cXf\");\nvar stringify_default = /*#__PURE__*/__webpack_require__.n(stringify);\n\n// CONCATENATED MODULE: ./node_modules/_babel-loader@7.1.4@babel-loader/lib!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=script&index=0!./src/components/book/add_new_book.vue\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* harmony default export */ var add_new_book = ({\n  data: function data() {\n    var _this = this;\n\n    var checkBookName = function checkBookName(rule, value, callback) {\n      var txt = _this.$http.trim(value);\n      if (txt.length < 1) {\n        return callback(new Error('作品名称不能为空'));\n      } else {\n        //            添加新书时校验书籍名称是否存在\n        var reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5:：]{1,20}$/;\n        if (!reg.test(txt)) {\n          callback(new Error('书籍名称只能包含中文、数字、字母和冒号'));return false;\n        }\n        _this.$ajax('/book-checkName', { bookName: txt }, function (json) {\n          if (json.returnCode !== 200) {\n            callback(new Error('作品名称已存在，请重新填写'));\n          } else {\n            callback();\n          }\n        });\n      }\n    };\n    return {\n      fullLoading: false,\n      activeName: 'base',\n      reloading: true,\n      baseData: {},\n      userList: [],\n      selectValue: {},\n      bookDetail: {\n        bookName: '',\n        writerName: '',\n        bookWriterId: '',\n        bookClassificationId: null,\n        bookLabId: [],\n        bookAuthorization: null,\n        bookIntroduction: ''\n      },\n      rules1: {\n        bookName: [{ required: true, validator: checkBookName, message: '请输入书名', trigger: 'blur' }],\n        writerName: [{ required: true, message: '请填写作者', trigger: 'blur' }],\n        bookClassificationId: [{ required: true, type: 'number', message: '请选择作品分类', trigger: 'change' }],\n        bookLabId: [{ type: 'array', required: true, message: '至少选取2个标签', trigger: 'change' }, { type: 'array', min: 2, max: 5, message: '请选择2-5个标签', trigger: 'change' }],\n        bookAuthorization: [{ required: true, type: 'number', message: '请选择发布状态', trigger: 'change' }],\n        bookIntroduction: [{ required: true, message: '请填写作品简介', trigger: 'blur' }, { min: 1, max: 400, message: '长度在 1 到 400 个字符', trigger: 'blur' }]\n      }\n\n    };\n  },\n\n  methods: {\n    onSubmit: function onSubmit(formName) {\n      var _this2 = this;\n\n      this.fullLoading = this.$loading({\n        lock: true,\n        text: 'Loading',\n        spinner: 'el-icon-loading',\n        background: 'rgba(0, 0, 0, 0.7)'\n      });\n      var formData = JSON.parse(stringify_default()(this.bookDetail));\n      formData.bookLabId = formData.bookLabId.toString();\n      formData.bookIntroduction = this.$http.trim(formData.bookIntroduction).replace(/\\s*\\n+\\s*/g, '\\n');\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          _this2.$ajax('/admin/addBookInfo', formData, function (res) {\n            _this2.$nextTick(function () {\n              _this2.fullLoading.close();\n            });\n            if (res.returnCode === 200) {\n              _this2.$confirm('创建成功, 可直接发布章节！', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n              }).then(function () {\n                _this2.$router.push({ path: '/add_new_chapter/' + res.data });\n              });\n            }\n          });\n        } else {\n          _this2.$nextTick(function () {\n            _this2.fullLoading.close();\n          });\n          _this2.$message({ message: '请完善信息后提交！', type: 'warning' });\n        }\n      });\n    },\n    remoteMethod: function remoteMethod(query) {\n      var _this3 = this;\n\n      if (query !== '') {\n        this.reloading = true;\n        this.$ajax('/getAuthorIdByAuthorName', { key: this.$http.trim(query) }, function (res) {\n          if (res.returnCode === 200) {\n            _this3.reloading = false;\n            _this3.userList = res.data.filter(function (item) {\n              return item.pseudonym.toLowerCase().indexOf(query.toLowerCase()) > -1;\n            });\n          }\n        });\n      } else {\n        this.userList = [];\n      }\n    },\n    getBaseInfo: function getBaseInfo() {\n      var _this4 = this;\n\n      this.$ajax('/book-EditBookEcho', '', function (res) {\n        if (res.returnCode === 200) {\n          _this4.baseData = res.data;\n        }\n      }, 'get');\n    },\n    getBookDetail: function getBookDetail() {\n      var _this5 = this;\n\n      this.$ajax('/book-showBookInfo', { bookid: this.$route.params.bid }, function (res) {\n        if (res.returnCode === 200) {\n          res.data.bookLabId = function () {\n            var arr = [];\n            res.data.bookLabId.split(',').forEach(function (item) {\n              arr.push(parseInt(item));\n            });\n            return arr;\n          }();\n          res.data.bookClassificationId = parseInt(res.data.bookClassificationId);\n          _this5.bookDetail = res.data;\n        }\n      });\n    }\n  },\n  created: function created() {\n    this.getBaseInfo();\n  },\n\n  watch: {\n    'bookDetail.bookIntroduction': function bookDetailBookIntroduction(val) {\n      this.bookDetail.bookIntroduction = val.replace(/\\s*\\n+\\s*/g, '\\n\\n');\n    },\n    'selectValue': function selectValue(val) {\n      if (val.name) {\n        this.bookDetail.writerName = val.name;\n        this.bookDetail.bookWriterId = val.id;\n      }\n    }\n  }\n});\n// CONCATENATED MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-f6406d54\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/book/add_new_book.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"add-new-book-wrap\"},[_c('el-breadcrumb',{staticClass:\"mbt20\",attrs:{\"separator-class\":\"el-icon-arrow-right\"}},[_c('el-breadcrumb-item',[_vm._v(\"书籍管理\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":\"/book/list\"}},[_vm._v(\"书籍列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',[_vm._v(\"新建书籍\")])],1),_vm._v(\" \"),_c('el-alert',{attrs:{\"title\":\"操作说明\",\"type\":\"info\",\"show-icon\":\"\"}},[_c('div',[_vm._v(\"\\n      新建书籍的作者必需已经存在，否则无法创建新书；书籍标签至少2个，最多不超过5个;且书籍简介不可超过字数上限\\n    \")])]),_vm._v(\" \"),_c('el-form',{ref:\"detailForm1\",staticClass:\"mbt20\",attrs:{\"rules\":_vm.rules1,\"model\":_vm.bookDetail,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"书籍名称\",\"prop\":\"bookName\"}},[_c('el-col',{attrs:{\"xs\":20,\"sm\":16,\"md\":12,\"lg\":9,\"xl\":4}},[_c('el-input',{model:{value:(_vm.bookDetail.bookName),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookName\", $$v)},expression:\"bookDetail.bookName\"}})],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作者笔名\",\"prop\":\"writerName\"}},[_c('el-col',{attrs:{\"xs\":20,\"sm\":16,\"md\":12,\"lg\":9,\"xl\":4}},[_c('el-select',{attrs:{\"filterable\":\"\",\"remote\":\"\",\"loading\":_vm.reloading,\"remote-method\":_vm.remoteMethod,\"placeholder\":\"请选择\"},model:{value:(_vm.selectValue),callback:function ($$v) {_vm.selectValue=$$v},expression:\"selectValue\"}},_vm._l((_vm.userList),function(item){return _c('el-option',{key:item.userId,attrs:{\"label\":item.pseudonym,\"value\":{id:item.userId,name:item.pseudonym}}},[_c('span',{staticStyle:{\"float\":\"left\"}},[_vm._v(_vm._s(item.pseudonym)+\"(\"+_vm._s(item.userId)+\")\")])])}))],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作品分类\",\"prop\":\"bookClassificationId\"}},[_c('el-select',{attrs:{\"placeholder\":\"请选择活动区域\"},model:{value:(_vm.bookDetail.bookClassificationId),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookClassificationId\", $$v)},expression:\"bookDetail.bookClassificationId\"}},_vm._l((_vm.baseData.classificationList),function(item,$index){return _c('el-option',{key:$index,attrs:{\"label\":item.classificationName,\"value\":item.id}})}))],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"书籍标签\",\"prop\":\"bookLabId\"}},[_c('el-checkbox-group',{model:{value:(_vm.bookDetail.bookLabId),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookLabId\", $$v)},expression:\"bookDetail.bookLabId\"}},_vm._l((_vm.baseData.booklablesList),function(item,$index){return _c('el-checkbox',{key:$index,attrs:{\"label\":item.id,\"name\":\"bookLabId\"}},[_vm._v(_vm._s(item.bookLableName))])}))],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"发布状态\",\"prop\":\"bookAuthorization\"}},[_c('el-radio-group',{model:{value:(_vm.bookDetail.bookAuthorization),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookAuthorization\", $$v)},expression:\"bookDetail.bookAuthorization\"}},[_c('el-radio',{attrs:{\"label\":0}},[_vm._v(\"网站首发\")]),_vm._v(\" \"),_c('el-radio',{attrs:{\"label\":1}},[_vm._v(\"授权发布\")])],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作品简介\",\"prop\":\"bookIntroduction\"}},[_c('el-input',{staticClass:\"book-intro\",attrs:{\"type\":\"textarea\"},model:{value:(_vm.bookDetail.bookIntroduction),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookIntroduction\", $$v)},expression:\"bookDetail.bookIntroduction\"}}),_vm._v(\" \"),_c('span',{staticClass:\"fr\"},[_vm._v(_vm._s(_vm.bookDetail.bookIntroduction.length)+\"/400\")])],1),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.onSubmit('detailForm1')}}},[_vm._v(\"\\n        保存提交\\n      \")])],1)],1)],1)}\nvar staticRenderFns = []\n\n// EXTERNAL MODULE: ./node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer.js\nvar component_normalizer = __webpack_require__(\"18Nq\");\n\n// CONCATENATED MODULE: ./src/components/book/add_new_book.vue\nfunction injectStyle (context) {\n  __webpack_require__(\"SAqg\")\n}\n/* script */\n\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\n\nvar Component = Object(component_normalizer[\"a\" /* default */])(\n  add_new_book,\n  render,\n  staticRenderFns,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var book_add_new_book = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"SAqg\":\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/58.147f970b4b190a20480f.js","function injectStyle (context) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=styles&index=0!./add_new_book.vue\")\n}\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./add_new_book.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=script&index=0!./add_new_book.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f6406d54\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/selector?type=template&index=0!./add_new_book.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/_vue-loader@14.2.2@vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/book/add_new_book.vue\n// module id = null\n// module chunks = ","<template>\n    <div class=\"add-new-book-wrap\">\n  \n      <el-breadcrumb class=\"mbt20\" separator-class=\"el-icon-arrow-right\">\n        <el-breadcrumb-item>书籍管理</el-breadcrumb-item>\n        <el-breadcrumb-item to=\"/book/list\">书籍列表</el-breadcrumb-item>\n        <el-breadcrumb-item >新建书籍</el-breadcrumb-item>\n      </el-breadcrumb>\n  \n  \n      <el-alert\n        title=\"操作说明\"\n        type=\"info\"\n        show-icon>\n        <div>\n          新建书籍的作者必需已经存在，否则无法创建新书；书籍标签至少2个，最多不超过5个;且书籍简介不可超过字数上限\n        </div>\n      </el-alert>\n      \n      <el-form class=\"mbt20\" ref=\"detailForm1\" :rules=\"rules1\" :model=\"bookDetail\" label-width=\"80px\">\n        <el-form-item label=\"书籍名称\" prop=\"bookName\">\n          <el-col :xs=\"20\" :sm=\"16\" :md=\"12\" :lg=\"9\" :xl=\"4\">\n            <el-input v-model=\"bookDetail.bookName\"></el-input>\n          </el-col>\n        </el-form-item>\n        <el-form-item label=\"作者笔名\" prop=\"writerName\">\n          <el-col :xs=\"20\" :sm=\"16\" :md=\"12\" :lg=\"9\" :xl=\"4\">\n            <el-select\n              v-model=\"selectValue\"\n              filterable\n              remote\n              :loading=\"reloading\"\n              :remote-method=\"remoteMethod\"\n              placeholder=\"请选择\">\n              <el-option\n                v-for=\"item in userList\"\n                :key=\"item.userId\"\n                :label=\"item.pseudonym\"\n                :value=\"{id:item.userId,name:item.pseudonym}\"\n                >\n                <span style=\"float: left\">{{ item.pseudonym }}({{item.userId}})</span>\n              </el-option>\n            </el-select>\n          </el-col>\n        </el-form-item>\n        <el-form-item label=\"作品分类\" prop=\"bookClassificationId\">\n          <el-select v-model=\"bookDetail.bookClassificationId\" placeholder=\"请选择活动区域\">\n            <el-option v-for=\"(item,$index) in baseData.classificationList\" :key=\"$index\" :label=\"item.classificationName\" :value=\"item.id\"></el-option>\n          </el-select>\n        </el-form-item>\n    \n        <el-form-item label=\"书籍标签\" prop=\"bookLabId\">\n          <el-checkbox-group v-model=\"bookDetail.bookLabId\">\n            <el-checkbox v-for=\"(item,$index) in baseData.booklablesList\" :label=\"item.id\" name=\"bookLabId\" :key=\"$index\">{{item.bookLableName}}</el-checkbox>\n          </el-checkbox-group>\n        </el-form-item>\n        <el-form-item label=\"发布状态\" prop=\"bookAuthorization\">\n          <el-radio-group v-model=\"bookDetail.bookAuthorization\">\n            <el-radio :label=\"0\">网站首发</el-radio>\n            <el-radio :label=\"1\">授权发布</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item label=\"作品简介\" prop=\"bookIntroduction\">\n          <el-input type=\"textarea\" class=\"book-intro\" v-model=\"bookDetail.bookIntroduction\"></el-input>\n          <span class=\"fr\">{{bookDetail.bookIntroduction.length}}/400</span>\n        </el-form-item>\n    \n        <el-form-item>\n          <el-button\n            type=\"primary\"\n            @click=\"onSubmit('detailForm1')\">\n            保存提交\n          </el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\n    export default{\n      data() {\n        const checkBookName = (rule, value, callback) => {\n          const txt = this.$http.trim(value)\n          if (txt.length < 1) {\n            return callback(new Error('作品名称不能为空'))\n          } else {\n//            添加新书时校验书籍名称是否存在\n            const reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5:：]{1,20}$/\n            if (!reg.test(txt)) { callback(new Error('书籍名称只能包含中文、数字、字母和冒号')); return false }\n            this.$ajax('/book-checkName',\n              { bookName: txt }, json => {\n                if (json.returnCode !== 200) {\n                  callback(new Error('作品名称已存在，请重新填写'))\n                } else {\n                  callback()\n                }\n              })\n          }\n        }\n    return {\n      fullLoading: false,\n      activeName: 'base',\n      reloading: true,\n      baseData: {},\n      userList: [],\n      selectValue: {},\n      bookDetail: {\n        bookName: '',\n        writerName: '',\n        bookWriterId: '',\n        bookClassificationId: null,\n        bookLabId: [],\n        bookAuthorization: null,\n        bookIntroduction: ''\n      },\n      rules1: {\n        bookName: [\n              { required: true, validator: checkBookName, message: '请输入书名', trigger: 'blur' }\n        ],\n        writerName: [\n              { required: true, message: '请填写作者', trigger: 'blur' }\n        ],\n        bookClassificationId: [\n              { required: true, type: 'number', message: '请选择作品分类', trigger: 'change' }\n        ],\n        bookLabId: [\n              { type: 'array', required: true, message: '至少选取2个标签', trigger: 'change' },\n              { type: 'array', min: 2, max: 5, message: '请选择2-5个标签', trigger: 'change' }\n        ],\n        bookAuthorization: [\n              { required: true, type: 'number', message: '请选择发布状态', trigger: 'change' }\n        ],\n        bookIntroduction: [\n              { required: true, message: '请填写作品简介', trigger: 'blur' },\n              { min: 1, max: 400, message: '长度在 1 到 400 个字符', trigger: 'blur' }\n        ]\n      }\n    \n    }\n      },\n      methods: {\n        onSubmit(formName) {\n          this.fullLoading = this.$loading({\n            lock: true,\n            text: 'Loading',\n            spinner: 'el-icon-loading',\n            background: 'rgba(0, 0, 0, 0.7)'\n          })\n          const formData = JSON.parse(JSON.stringify(this.bookDetail))\n          formData.bookLabId = formData.bookLabId.toString()\n          formData.bookIntroduction = this.$http.trim(formData.bookIntroduction).replace(/\\s*\\n+\\s*/g, '\\n')\n          this.$refs[formName].validate((valid) => {\n            if (valid) {\n              this.$ajax('/admin/addBookInfo', formData, res => {\n                this.$nextTick(() => {\n                  this.fullLoading.close()\n                })\n                if (res.returnCode === 200) {\n                  this.$confirm('创建成功, 可直接发布章节！', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                  }).then(() => {\n                    this.$router.push({ path: '/add_new_chapter/' + res.data })\n                  })\n                }\n              })\n            } else {\n              this.$nextTick(() => {\n                this.fullLoading.close()\n              })\n              this.$message({ message: '请完善信息后提交！', type: 'warning' })\n            }\n          })\n    },\n        remoteMethod(query) {\n          if (query !== '') {\n            this.reloading = true\n            this.$ajax('/getAuthorIdByAuthorName', { key: this.$http.trim(query) }, res => {\n              if (res.returnCode === 200) {\n                this.reloading = false\n                this.userList = res.data.filter(item => {\n                  return item.pseudonym.toLowerCase()\n                    .indexOf(query.toLowerCase()) > -1\n                })\n              }\n            })\n          } else {\n            this.userList = []\n          }\n        },\n    \n        getBaseInfo() {\n          this.$ajax('/book-EditBookEcho', '', res => {\n            if (res.returnCode === 200) {\n              this.baseData = res.data\n            }\n          }, 'get')\n        },\n        getBookDetail() {\n          this.$ajax('/book-showBookInfo', { bookid: this.$route.params.bid }, res => {\n            if (res.returnCode === 200) {\n              res.data.bookLabId = (() => {\n                const arr = []\n                res.data.bookLabId.split(',').forEach((item) => {\n                  arr.push(parseInt(item))\n                })\n                return arr\n              })()\n              res.data.bookClassificationId = parseInt(res.data.bookClassificationId)\n              this.bookDetail = res.data\n            }\n          })\n        }\n      },\n      created() {\n        this.getBaseInfo()\n      },\n      watch: {\n        'bookDetail.bookIntroduction': function(val) {\n          this.bookDetail.bookIntroduction = val.replace(/\\s*\\n+\\s*/g, '\\n\\n')\n        },\n        'selectValue': function(val) {\n          if (val.name) {\n            this.bookDetail.writerName = val.name\n            this.bookDetail.bookWriterId = val.id\n          }\n        }\n      }\n    }\n</script>\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/book/add_new_book.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"add-new-book-wrap\"},[_c('el-breadcrumb',{staticClass:\"mbt20\",attrs:{\"separator-class\":\"el-icon-arrow-right\"}},[_c('el-breadcrumb-item',[_vm._v(\"书籍管理\")]),_vm._v(\" \"),_c('el-breadcrumb-item',{attrs:{\"to\":\"/book/list\"}},[_vm._v(\"书籍列表\")]),_vm._v(\" \"),_c('el-breadcrumb-item',[_vm._v(\"新建书籍\")])],1),_vm._v(\" \"),_c('el-alert',{attrs:{\"title\":\"操作说明\",\"type\":\"info\",\"show-icon\":\"\"}},[_c('div',[_vm._v(\"\\n      新建书籍的作者必需已经存在，否则无法创建新书；书籍标签至少2个，最多不超过5个;且书籍简介不可超过字数上限\\n    \")])]),_vm._v(\" \"),_c('el-form',{ref:\"detailForm1\",staticClass:\"mbt20\",attrs:{\"rules\":_vm.rules1,\"model\":_vm.bookDetail,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"书籍名称\",\"prop\":\"bookName\"}},[_c('el-col',{attrs:{\"xs\":20,\"sm\":16,\"md\":12,\"lg\":9,\"xl\":4}},[_c('el-input',{model:{value:(_vm.bookDetail.bookName),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookName\", $$v)},expression:\"bookDetail.bookName\"}})],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作者笔名\",\"prop\":\"writerName\"}},[_c('el-col',{attrs:{\"xs\":20,\"sm\":16,\"md\":12,\"lg\":9,\"xl\":4}},[_c('el-select',{attrs:{\"filterable\":\"\",\"remote\":\"\",\"loading\":_vm.reloading,\"remote-method\":_vm.remoteMethod,\"placeholder\":\"请选择\"},model:{value:(_vm.selectValue),callback:function ($$v) {_vm.selectValue=$$v},expression:\"selectValue\"}},_vm._l((_vm.userList),function(item){return _c('el-option',{key:item.userId,attrs:{\"label\":item.pseudonym,\"value\":{id:item.userId,name:item.pseudonym}}},[_c('span',{staticStyle:{\"float\":\"left\"}},[_vm._v(_vm._s(item.pseudonym)+\"(\"+_vm._s(item.userId)+\")\")])])}))],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作品分类\",\"prop\":\"bookClassificationId\"}},[_c('el-select',{attrs:{\"placeholder\":\"请选择活动区域\"},model:{value:(_vm.bookDetail.bookClassificationId),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookClassificationId\", $$v)},expression:\"bookDetail.bookClassificationId\"}},_vm._l((_vm.baseData.classificationList),function(item,$index){return _c('el-option',{key:$index,attrs:{\"label\":item.classificationName,\"value\":item.id}})}))],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"书籍标签\",\"prop\":\"bookLabId\"}},[_c('el-checkbox-group',{model:{value:(_vm.bookDetail.bookLabId),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookLabId\", $$v)},expression:\"bookDetail.bookLabId\"}},_vm._l((_vm.baseData.booklablesList),function(item,$index){return _c('el-checkbox',{key:$index,attrs:{\"label\":item.id,\"name\":\"bookLabId\"}},[_vm._v(_vm._s(item.bookLableName))])}))],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"发布状态\",\"prop\":\"bookAuthorization\"}},[_c('el-radio-group',{model:{value:(_vm.bookDetail.bookAuthorization),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookAuthorization\", $$v)},expression:\"bookDetail.bookAuthorization\"}},[_c('el-radio',{attrs:{\"label\":0}},[_vm._v(\"网站首发\")]),_vm._v(\" \"),_c('el-radio',{attrs:{\"label\":1}},[_vm._v(\"授权发布\")])],1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"作品简介\",\"prop\":\"bookIntroduction\"}},[_c('el-input',{staticClass:\"book-intro\",attrs:{\"type\":\"textarea\"},model:{value:(_vm.bookDetail.bookIntroduction),callback:function ($$v) {_vm.$set(_vm.bookDetail, \"bookIntroduction\", $$v)},expression:\"bookDetail.bookIntroduction\"}}),_vm._v(\" \"),_c('span',{staticClass:\"fr\"},[_vm._v(_vm._s(_vm.bookDetail.bookIntroduction.length)+\"/400\")])],1),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.onSubmit('detailForm1')}}},[_vm._v(\"\\n        保存提交\\n      \")])],1)],1)],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@14.2.2@vue-loader/lib/template-compiler?{\"id\":\"data-v-f6406d54\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@14.2.2@vue-loader/lib/selector.js?type=template&index=0!./src/components/book/add_new_book.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}