webpackJsonp([2],{"3InB":function(t,e){},XGY8:function(t,e,s){"use strict";function a(t){s("oq4m")}function o(t){s("3InB")}Object.defineProperty(e,"__esModule",{value:!0});var r=s("3cXf"),i=s.n(r),n=(s("Umb+"),s("BMa3"),{title:"表格编辑器",data:function(){return{rowNum:6,colNum:6,tableArr:[],tableTitle:["书籍编号","书籍名称","作者编号","作者名称","第三方","考勤"],copyContent:"",date:""}},created:function(){var t=new Date,e=t.getFullYear(),s=t.getMonth();this.date=e+"-"+s},methods:{sendFather:function(t){"close"===t?this.$emit("fromChild",!1,"close"):this.$emit("fromChild",!1,"succ"),this.tableArr=[],this.copyContent=""},repeat:function(){this.rowNum=6,this.colNum=6,this.tableArr=[],this.copyContent=""},createTable:function(){for(var t=new Array,e=0;e<this.rowNum;e++){t[e]=new Array;for(var s=0;s<this.colNum;s++)t[e][s]=""}this.tableArr=t},submitData:function(){var t=this;if(""!==this.date)if(0!=this.tableArr.length){for(var e=this.tableArr,s={},a=[],o=0;o<e.length;o++){var r=new Object;r.bookid=e[o][0]?e[o][0]:"",r.bookName=e[o][1]?e[o][1]:"",r.authorid=e[o][2]?e[o][2]:"",r.authorName=e[o][3]?e[o][3]:"",r.thirdPart=e[o][4]?e[o][4]:0,r.checkworkattendance=e[o][5]?e[o][5]:0,a[o]=r}s.data=new Object,s.data.list=a,s.data=i()(s.data),s.startdate=this.date+"-01 00:00:00",s.enddate=this.date+"-31 23:59:59",this.$store.dispatch("generateMonthlyreport",s).then(function(e){t.$message({message:"操作成功",type:"success"}),t.sendFather("succ")})}else this.$message({message:"请编辑表格",type:"warning"});else this.$message({message:"请选择时间",type:"warning"})}},watch:{copyContent:function(t){var e=t.replace(/(^\s*)|(\s*$)/g,"");e=e.split("\n");for(var s=0;s<e.length;s++)e[s]=e[s].replace(/\s+/g," "),e[s]=e[s].replace(/(^\s*)|(\s*$)/g,""),e[s]=e[s].split(" ");"书籍编号"===e[0][0]&&e.shift(),this.tableArr=e}}}),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mounth-component"},[s("div",{staticClass:"mounth-header"},[s("el-row",[s("h2",[t._v("表格编辑器")]),t._v(" "),s("i",{staticClass:"el-icon-close",on:{click:function(e){t.sendFather("close")}}})]),t._v(" "),s("el-row",{staticClass:"header-row"},[s("el-date-picker",{staticClass:"fl",staticStyle:{width:"200px"},attrs:{type:"month","value-format":"yyyy-MM",placeholder:"选择月"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}),t._v(" "),s("span",[t._v("行数")]),t._v(" "),s("el-input-number",{staticClass:"row-num",attrs:{size:"small"},model:{value:t.rowNum,callback:function(e){t.rowNum=e},expression:"rowNum"}}),t._v(" "),s("span",[t._v("列数")]),t._v(" "),s("el-input-number",{staticClass:"col-num",attrs:{size:"small",disabled:!0},model:{value:t.colNum,callback:function(e){t.colNum=e},expression:"colNum"}}),t._v(" "),s("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){t.createTable()}}},[t._v("生成表格")]),t._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",circle:""},on:{click:function(e){t.repeat()}}}),t._v(" "),s("el-button",{staticClass:"submit-btn",attrs:{type:"primary",round:""},on:{click:function(e){t.submitData()}}},[t._v("提 交")])],1),t._v(" "),s("el-row",[s("el-input",{attrs:{type:"textarea",resize:"none",placeholder:"复制区域"},model:{value:t.copyContent,callback:function(e){t.copyContent=e},expression:"copyContent"}})],1)],1),t._v(" "),s("div",{staticClass:"mounth-section"},[s("el-row",{staticClass:"table-row"},t._l(t.tableTitle,function(e,a){return s("el-input",{key:a,staticClass:"table-col",attrs:{disabled:!0},model:{value:t.tableTitle[a],callback:function(e){t.$set(t.tableTitle,a,e)},expression:"tableTitle[index]"}})})),t._v(" "),t._l(t.tableArr,function(e,a){return s("el-row",{key:a,staticClass:"table-row"},t._l(e,function(e,o){return s("el-input",{key:o,staticClass:"table-col",model:{value:t.tableArr[a][o],callback:function(e){t.$set(t.tableArr[a],o,e)},expression:"tableArr[rowIndex][colIndex]"}})}))})],2)])},c=[],u=s("18Nq"),p=a,m=Object(u.a)(n,l,c,!1,p,null,null),h=m.exports,d={components:{MounthComponent:h},data:function(){return{dialogVisible:!1,searchForm:{},defaultValue:null,pickerOptions:{disabledDate:function(t){return t.getTime()>Date.now()}},reportCommentList:{},keywords:"",selectType:"bookName",multipleSelection:[],userInfo:{},date:"",setTime:"",isOpenEdit:!1,dateObj:{starttime:"",endtime:""}}},created:function(){this.getPublishTime(),this.getUserInfo()},methods:{sendFather:function(t,e){"succ"===e&&(this.getPublishTime(),this.getUserInfo()),this.isOpenEdit=t},getReportStatisticList:function(){var t=this,e="/admin/getAuthorMonthlyreportAdminList";if(this.searchForm={},this.searchForm.page=this.$route.params.page,this.$route.params.aid&&(this.searchForm.authorid=this.$route.params.aid),this.selectType&&this.keywords){if(("bookId"===this.selectType||"userId"===this.selectType)&&!Number(this.keywords))return this.$message({message:"ID必需为数字",type:"warning"}),!1;this.searchForm[this.selectType]=this.keywords}this.date&&(this.searchForm.year=this.date.split("-")[0],this.searchForm.month=this.date.split("-")[1]),"authorMonReport"===this.$route.name&&(e="/admin/getAuthorMonthlyreportByAuthormon"),this.$ajax(e,this.searchForm,function(e){200===e.returnCode?"authorMonReport"===t.$route.name?t.$set(t.reportCommentList,"list",[e.data]):t.reportCommentList=e.data:e.data||(t.reportCommentList={})})},searchReplyCom:function(){1===Number(this.$route.params.page)?this.getReportStatisticList():this.$router.push({params:{page:1}})},handleCurrentChange:function(t){this.$router.push({params:{page:t}})},getUserInfo:function(){var t=this;this.$route.params.aid&&this.$ajax("/person-SimplifyUserInfo",{puserid:this.$route.params.aid},function(e){200===e.returnCode&&(t.userInfo=e.data)})},excelProgress:function(t){this.$myLoad("正在上传中...")},progressEnd:function(t,e){200===t.returnCode&&this.$message({message:t.msg,type:"success"}),this.$loading().close()},getPublishTime:function(){var t=this;this.$store.dispatch("getDataPosition").then(function(e){t.setTime=e;var s=new Date,a=s.getFullYear(),o=s.getMonth();t.date=a+"-"+o,t.getReportStatisticList()})},setPublishTime:function(){var t=this;this.setTime?this.$ajax("/sys-setDataPosition",{date:this.setTime},function(e){200===e.returnCode&&(t.$message({message:e.msg,type:"success"}),t.getPublishTime())},"get"):this.$message({message:"请选取月份",type:"warning"})},oneKeyMonthly:function(){var t=this;if(this.date){var e=this.date.split("-"),s=this.date+"-"+new Date(e[0],e[1],0).getDate()+" 23:59:59",a=this.date+"-01 00:00:00";this.$ajax("/generateMonthlyreport",{startdate:a,enddate:s},function(e){200===e.returnCode&&(t.$message({message:e.msg,type:"success"}),t.getReportStatisticList())},"get")}else this.$message({message:"请选取时间",type:"warning"})},editMonthly:function(t){this.date?this.$router.push({name:"authorEditMonReport",params:{bid:t.bookid,time:this.date}}):this.$message({message:"请选取时间",type:"warning"})}},computed:{isAuthor:function(){return"authorMonReport"!==this.$route.name}},watch:{$route:function(){this.getReportStatisticList()},date:function(t,e){""!==e&&this.getReportStatisticList(),this.$store.state.date=t}}},b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"reply-comment-wrap"},[s("el-alert",{attrs:{title:"",type:"info","show-icon":""}},[s("div",[s("p",[t._v("\n                此表为\n                "),s("span",{staticClass:"red"},[t._v(t._s(t.$route.params.aid?t.userInfo.pseudonym:"全站"))]),t._v("\n                的月报列表，您可以通过相应类型进行精确搜索\n                "),t.$route.params.aid?s("span",[t._v(",您也可以直接"),s("router-link",{attrs:{to:"/author/add_monthly/"+t.userInfo.userId}},[t._v("添加月报")])],1):t._e()]),t._v(" "),s("p",[s("span",{staticClass:"red"},[t._v("说明：")]),t._v("每月15号后台会自动生成上一个月的月报，如果出现异常管理员可以进行手动生成；月报会根据最新上传的excel表格里的书单进行生成，请及时更新模板及时更新excel表单")]),t._v(" "),s("p",[s("span",{staticClass:"red"},[t._v("ps：")]),t._v("发布时间是指全站可以让作者查看最新月报的时间")])])]),t._v(" "),t.isAuthor?s("el-row",{staticClass:"mbt20"},[t._v("\n        发布时间：\n        "),s("el-date-picker",{staticClass:"input-with-select",staticStyle:{width:"140px"},attrs:{placeholder:"选择月",type:"month","value-format":"yyyy-MM"},model:{value:t.setTime,callback:function(e){t.setTime=e},expression:"setTime"}}),t._v(" "),s("el-button",{on:{click:t.setPublishTime}},[t._v("更新")]),t._v(" "),t.isAuthor?s("el-button",{staticClass:"fr",attrs:{size:"medium"},on:{click:t.oneKeyMonthly}},[t._v("一键月报")]):t._e()],1):t._e(),t._v(" "),s("el-row",{staticClass:"mbt20"},[s("el-date-picker",{staticClass:"fl",staticStyle:{width:"120px"},attrs:{type:"month","value-format":"yyyy-MM",placeholder:"选择月"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}),t._v(" "),t.isAuthor?s("el-col",{attrs:{xs:20,sm:16,md:12,lg:9,xl:6}},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.searchReplyCom(e):null}},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}},["authorMonReport"==t.$route.name?s("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[s("el-option",{attrs:{label:"书  名",value:"bookName"}}),t._v(" "),s("el-option",{attrs:{label:"书籍ID",value:"bookid"}})],1):s("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[s("el-option",{attrs:{label:"书  名",value:"bookName"}}),t._v(" "),s("el-option",{attrs:{label:"作者名",value:"authorName"}}),t._v(" "),s("el-option",{attrs:{label:"作者ID",value:"authorid"}}),t._v(" "),s("el-option",{attrs:{label:"书籍ID",value:"bookid"}})],1),t._v(" "),s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchReplyCom},slot:"append"})],1)],1):t._e(),t._v(" "),t.isAuthor?s("el-upload",{staticClass:"upload-demo fr",staticStyle:{display:"inline-block"},attrs:{"show-file-list":!1,"on-progress":t.excelProgress,"on-success":t.progressEnd,"on-error":t.progressEnd,action:"https://www.lajixs.com/api/uploadExcel"}}):t._e(),t._v(" "),s("el-button",{staticClass:"edit-btn fr",attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(e){t.isOpenEdit=!0}}})],1),t._v(" "),s("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.reportCommentList.list,border:""}},[s("el-table-column",{attrs:{type:"selection"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bookid",label:"书籍ID"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bookName",label:"书名"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bookName",label:"作者"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.authorName)+"(id:"+t._s(e.row.authorid)+")")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"thirdPart",label:"第三方"}}),t._v(" "),s("el-table-column",{attrs:{prop:"checkworkattendance",label:"考勤"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bubscribe",label:"订阅"}}),t._v(" "),s("el-table-column",{attrs:{prop:"pepper",label:"打赏"}}),t._v(" "),s("el-table-column",{attrs:{prop:"millet",label:"小米椒"}}),t._v(" "),t.isAuthor?s("el-table-column",{attrs:{prop:"replyCommentsContent",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(t._f("time")(e.row.dataTime,"sort")))])]}}])}):t._e(),t._v(" "),t.isAuthor?s("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("a",{attrs:{href:"javascript:0;"},on:{click:function(s){t.editMonthly(e.row)}}},[t._v("编辑")])]}}])}):t._e()],1),t._v(" "),s("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.reportCommentList.total>t.reportCommentList.pageSize,expression:"reportCommentList.total>reportCommentList.pageSize"}],staticClass:"mbt20",attrs:{background:"","current-page":t.reportCommentList.pageNum,"page-size":t.reportCommentList.pageSize,layout:"total, prev, pager, next, jumper",total:t.reportCommentList.total},on:{"current-change":t.handleCurrentChange}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpenEdit,expression:"isOpenEdit"}],staticClass:"shadeFloor"}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpenEdit,expression:"isOpenEdit"}],staticClass:"edit-box"},[s("mounth-component",{attrs:{dateObj:t.dateObj},on:{fromChild:t.sendFather}})],1)],1)},v=[],f=o,y=Object(u.a)(d,b,v,!1,f,null,null);e.default=y.exports},oq4m:function(t,e){}});
//# sourceMappingURL=2.aaa8db028db3d14bbd5c.js.map