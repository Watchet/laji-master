webpackJsonp([4],{WdPN:function(t,e){},nqCS:function(t,e,o){"use strict";function a(t){o("WdPN")}Object.defineProperty(e,"__esModule",{value:!0});var i={components:{"pic-cropper":function(){return o.e(68).then(o.bind(null,"PsVy"))}},data:function(){return{currentTitle:"",dialogTableVisible:!1,bookList:{},updateData:{},multipleSelection:[],keywords:null,selectType:"bookName",fold:!1,filterList:{orderParemeter:-1,bookCheckStatus:-1,bookStatus:-1},$routeParams:"",keepAlive:!1,firstOne:!0,editTitle:!1,hiddenIcon:!0}},methods:{getBookList:function(){var t=this,e={page:this.$routeParams.page,orderParemeter:"bookId"};"bookInfo"===this.$route.name&&(e={page:1,orderParemeter:"bookId"},this.selectType="bookId",this.keywords=this.$route.params.bid);var o=this.$http.trim(this.keywords);if(this.selectType&&o){if(("bookId"===this.selectType||"bookWriterId"===this.selectType)&&!Number(o))return this.$message({message:"ID必需为数字",type:"warning"}),!1;e[this.selectType]=o,this.bookList={}}for(var a in this.filterList)("number"==typeof this.filterList[a]&&this.filterList[a]>-1||"string"==typeof this.filterList[a])&&(e[a]=this.filterList[a]);"bookList"!==this.$route.name&&"bookInfo"!==this.$route.name||this.$ajax("/admin/getBookInfoList",e,function(e){200===e.returnCode?(t.bookList=e.data,t.bookList.list.forEach(function(e,o){t.$set(t.bookList.list[o],"edit",!1),t.$set(t.bookList.list[o],"hidden",!0)})):e.data||(t.bookList={})})},searchBook:function(){1!==Number(this.$route.params.page)?this.$router.push({params:{page:1}}):this.getBookList()},toggleSelection:function(){var t=this;if(this.multipleSelection.length){var e=[];this.multipleSelection.forEach(function(t){e.push(t.bookId)}),this.$confirm("此操作将永久删除所选的"+e.length+"书籍, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$ajax("/admin/bookBatchDelete",{bookid:e.toString()},function(e){200===e.returnCode&&(t.$message({message:"删除成功！",type:"success"}),t.getBookList())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}else this.$message({message:" 请选择要删除的书籍！",type:"warning"})},handleRowClick:function(t,e,o){"操作"!==o.label&&"书名"!==o.label&&this.$refs.multipleTable.toggleRowSelection(t)},handleSelectionChange:function(t){this.multipleSelection=t},handleClick:function(t,e){"a"===t?this.$router.push({path:"/book_chapter_list/"+e.bookId}):"b"===t?this.$router.push({path:"/book_detail/"+e.bookId}):"c"===t?this.$router.push({path:"/add_new_chapter/"+e.bookId}):"d"===t&&this.toggleSelection()},handleCurrentChange:function(t){this.$router.push({params:{page:t}})},openEdit:function(t){var e=this;this.bookList.list.forEach(function(t,o){t.edit&&e.$set(e.bookList.list[o],"edit",!1)}),this.currentTitle=t.bookName,t.edit=!0},keyCode:function(t,e){13===t.keyCode&&this.updateBookTitle(e)},updateBookTitle:function(t){var e=this;this.currentTitle!==t.bookName?this.$ajax("/admin/updateBookName",{bookId:t.bookId,bookName:this.currentTitle},function(o){200===o.returnCode&&(e.$message({message:o.msg,type:"success"}),e.keywords&&(e.keywords=e.currentTitle),e.getBookList(),t.edit=!1)}):t.edit=!1},dialogShow:function(t){this.dialogTableVisible=!0,this.$set(this.updateData,"bookId",t.bookId),this.$set(this.updateData,"bookImage",t.bookImage)},closeIt:function(){this.dialogTableVisible=!1},successBack:function(t){200===t.returnCode&&this.getBookList()},handleChange:function(t,e){var o=this,a={bookId:e.bookId},i=function(t){o.$store.dispatch("sysbookupdate",t).then(function(t){200===t.returnCode&&(o.$message({type:"success",message:t.msg}),o.getBookList())})};this.$confirm("此操作将更改本书籍状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){"连载"===t?(a.bookStatus=0===e.bookStatus?1:0,i(a),console.log(a)):"审核"===t?o.$store.dispatch("getChapterCount",{bookId:a.bookId}).then(function(t){200===t.returnCode&&t.data>1?(a.bookCheckStatus=0===e.bookCheckStatus?1:0,console.log(a),i(a)):o.$message({message:"已发布章节不足两章，不可通过审核！",type:"warning"})}):"上架"===t?0===e.bookCheckStatus?o.$message({type:"warning",message:"书籍暂未审核，请先审核通过！"}):(a.bookCheckStatus=1===e.bookCheckStatus?2:1,console.log(a),i(a)):"征文"===t&&(a.collectionDocuments=0===e.collectionDocuments?1:0,console.log(a),i(a))}).catch(function(){o.$message({type:"info",message:"已取消操作！"})})}},created:function(){this.firstOne&&(this.$routeParams=this.$route.params,this.getBookList(),this.firstOne=!1)},activated:function(t){this.firstOne||(this.$routeParams=this.$route.params,this.getBookList())},watch:{$route:function(t){this.$routeParams=t.params,this.getBookList()},filterList:{handler:function(){this.getBookList()},deep:!0}},computed:{authority:function(){return this.$store.state.userInfo.adminRolemenuanduserrole?this.$store.state.userInfo.adminRolemenuanduserrole:{}}}},s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"admin-book-wrap"},[o("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[o("div",[o("p",[t._v("\n                此表为本站全部书籍列表，您可以通过相应书籍ID来批量管理，也可以通过\n                "),t.authority.adds?o("router-link",{staticClass:"red",attrs:{to:{name:"addNewBook"}}},[t._v("新建书籍")]):t._e(),t._v("来添加新书\n            ")],1),t._v(" "),o("p",[o("span",{staticClass:"red"},[t._v("提示：")]),t._v("需要更多详细筛选条件请直接点击 "),o("a",{attrs:{href:"javascript:0;"},on:{click:function(e){t.fold?t.fold=!1:t.fold=!0}}},[t._v("展开")]),t._v("；双击书名可进行修改\n            ")])])]),t._v(" "),o("el-row",{directives:[{name:"show",rawName:"v-show",value:t.fold,expression:"fold"}],staticClass:"mbt20 fitler-search"},[o("div",[t._v("\n            排序类型：\n            "),o("el-radio-group",{model:{value:t.filterList.orderParemeter,callback:function(e){t.$set(t.filterList,"orderParemeter",e)},expression:"filterList.orderParemeter"}},[o("el-radio-button",{attrs:{label:-1}},[t._v("全部")]),t._v(" "),o("el-radio-button",{attrs:{label:"bookCreatedTime"}},[t._v("创建时间")]),t._v(" "),o("el-radio-button",{attrs:{label:"bookWorldCount"}},[t._v("字数")]),t._v(" "),o("el-radio-button",{attrs:{label:"lastUpdateTime"}},[t._v("更新时间")])],1)],1),t._v(" "),o("div",[t._v("\n            书籍状态：\n            "),o("el-radio-group",{model:{value:t.filterList.bookCheckStatus,callback:function(e){t.$set(t.filterList,"bookCheckStatus",e)},expression:"filterList.bookCheckStatus"}},[o("el-radio-button",{attrs:{label:-1}},[t._v("全部")]),t._v(" "),o("el-radio-button",{attrs:{label:0}},[t._v("未审核")]),t._v(" "),o("el-radio-button",{attrs:{label:1}},[t._v("已审核")]),t._v(" "),o("el-radio-button",{attrs:{label:2}},[t._v("已上架")])],1)],1),t._v(" "),o("div",[t._v("\n            连载状态：\n            "),o("el-radio-group",{model:{value:t.filterList.bookStatus,callback:function(e){t.$set(t.filterList,"bookStatus",e)},expression:"filterList.bookStatus"}},[o("el-radio-button",{attrs:{label:-1}},[t._v("全部")]),t._v(" "),o("el-radio-button",{attrs:{label:0}},[t._v("连载中")]),t._v(" "),o("el-radio-button",{attrs:{label:1}},[t._v("已完结")])],1)],1)]),t._v(" "),o("el-row",{staticClass:"mbt20"},[t.authority.deletes?o("el-button",{attrs:{type:"danger",plain:""},on:{click:function(e){t.toggleSelection()}}},[t._v("批量删除")]):t._e()],1),t._v(" "),o("el-row",{staticClass:"mbt20"},[o("el-col",{attrs:{xs:20,sm:16,md:12,lg:9,xl:6}},[o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.searchBook(e):null}},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}},[o("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[o("el-option",{attrs:{label:"书  名",value:"bookName"}}),t._v(" "),o("el-option",{attrs:{label:"作 者",value:"writerName"}}),t._v(" "),o("el-option",{attrs:{label:"书籍ID",value:"bookId"}}),t._v(" "),o("el-option",{attrs:{label:"作者ID",value:"bookWriterId"}}),t._v(" "),o("el-option",{attrs:{label:"手机号",value:"userPhone"}})],1),t._v(" "),o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchBook},slot:"append"})],1)],1)],1),t._v(" "),o("el-row",[o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.bookList.list,border:"",stripe:""},on:{"row-click":t.handleRowClick,"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"30"}}),t._v(" "),o("el-table-column",{attrs:{width:"80",label:"封面"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"cover-wrap",on:{click:function(o){t.dialogShow(e.row)}}},[o("img",{staticClass:"cover",attrs:{src:e.row.bookImage,alt:""}}),t._v(" "),e.row.bookRemarks?o("div",{staticClass:"remark"}):t._e(),t._v(" "),e.row.bookRemarks?o("div",{staticClass:"remark-font"},[t._v("豆腐小说")]):t._e()])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookId",width:"80",label:"ID"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookName",label:"书名"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("p",{on:{mouseover:function(t){e.row.hidden=!1},mouseout:function(t){e.row.hidden=!0}}},[t._v("\n                        "+t._s(e.row.bookName)+"\n                        "),o("i",{staticClass:"fa fa-edit",style:{cursor:"pointer",visibility:e.row.hidden?"hidden":null},on:{click:function(o){t.openEdit(e.row)}}})]),t._v(" "),o("el-popover",{attrs:{placement:"top"},model:{value:e.row.edit,callback:function(o){t.$set(e.row,"edit",o)},expression:"scope.row.edit"}},[o("el-input",{staticStyle:{width:"100%"},on:{keydown:function(o){t.keyCode(o,e.row)}},model:{value:t.currentTitle,callback:function(e){t.currentTitle=e},expression:"currentTitle"}}),t._v(" "),o("div",{staticStyle:{"text-align":"left",margin:"10px 0 0 0",bottom:"20px"}},[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){t.updateBookTitle(e.row)}}},[t._v("确定")]),t._v(" "),o("el-button",{attrs:{size:"mini"},on:{click:function(t){e.row.edit=!1}}},[t._v("取消")])],1)],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"作者",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.writerName)+"(id:"+t._s(e.row.bookWriterId)+")\n                ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"是否连载",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{on:{click:function(o){t.handleChange("连载",e.row)}}},[o("el-switch",{attrs:{value:0!==e.row.bookStatus}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"是否审核",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{on:{click:function(o){t.handleChange("审核",e.row)}}},[o("el-switch",{attrs:{value:!!e.row.bookCheckStatus}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"是否上架",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{on:{click:function(o){t.handleChange("上架",e.row)}}},[o("el-switch",{attrs:{value:2===e.row.bookCheckStatus}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"是否征文",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{on:{click:function(o){t.handleChange("征文",e.row)}}},[o("el-switch",{attrs:{value:0!==e.row.collectionDocuments}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(t._f("time")(e.row.bookCreatedTime,"long")))])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"更新时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(t._f("time")(e.row.lastUpdateTime,"long")))])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"bookWorldCount",label:"字数",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{label:"最后更新",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",[t._v(t._s(e.row.lastUpdateChapterName))])]}}])}),t._v(" "),o("el-table-column",{staticClass:"last-column",attrs:{label:"操作",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-dropdown",{attrs:{trigger:"click",size:"medium",placement:"bottom"},on:{command:function(o){t.handleClick(o,e.row)}}},[o("a",{staticClass:"btn",attrs:{href:"javascript:0;"}},[t._v("更多")]),t._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.authority.shows?o("el-dropdown-item",{attrs:{command:"a"}},[t._v("章节列表")]):t._e(),t._v(" "),t.authority.updates?o("el-dropdown-item",{attrs:{command:"b"}},[t._v("编辑详情")]):t._e(),t._v(" "),t.authority.adds?o("el-dropdown-item",{attrs:{command:"c"}},[t._v("添加章节")]):t._e(),t._v(" "),t.authority.deletes?o("el-dropdown-item",{staticClass:"danger",attrs:{command:"d"}},[t._v("删除书籍")]):t._e()],1)],1)]}}])})],1),t._v(" "),o("el-pagination",{staticClass:"mbt20",attrs:{background:"","current-page":t.bookList.pageNum,"page-size":t.bookList.pageSize,layout:"total, prev, pager, next, jumper",total:t.bookList.total},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),o("pic-cropper",{ref:"avatarUpdate",attrs:{action:"https://www.lajixs.com/api/admin/updateBookCoverAvatarimgUpload",visible:t.dialogTableVisible,maxWidth:400,data:{bookid:t.updateData.bookId},url:"/static/img/defaultcoverimg.jpg",aspectRatio:.75},on:{"update:visible":function(e){t.dialogTableVisible=e},close:t.closeIt,success:t.successBack}})],1)},n=[],l=o("18Nq"),r=a,c=Object(l.a)(i,s,n,!1,r,null,null);e.default=c.exports}});
//# sourceMappingURL=4.6b02930228ab22a3d642.js.map