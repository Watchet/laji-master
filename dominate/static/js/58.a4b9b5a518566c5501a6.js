webpackJsonp([58],{N8tl:function(t,e,a){"use strict";function s(t){a("Rq2q")}Object.defineProperty(e,"__esModule",{value:!0});var i=a("3cXf"),n=a.n(i),o=a("405r"),r=a.n(o),c={components:{draggable:r.a},data:function(){return{checkList:[],centerDialogVisible:!1,chapterList:[],cloneList:[],updateData:{},page:1,multipleSelection:[],newDrag:!0,bookInfo:{},$routeParams:""}},methods:{getChapterList:function(){var t=this;this.$ajax("/books-adminChapterList/"+this.$route.params.bid,"",function(e){var a=[];200===e.returnCode&&(e.data.reverse().forEach(function(t){t.resultList.length>0&&(a=a.concat(t.resultList.reverse()))}),t.chapterList=a.reverse())},"get")},getBookInfo:function(){var t=this;this.$ajax("/book-showBookInfo",{bookid:this.$route.params.bid},function(e){200===e.returnCode&&(t.bookInfo=e.data)})},dragState:function(t){var e=t.draggedContext,a=this.cloneList[e.index].volumeId===this.cloneList[e.futureIndex].volumeId&&!this.cloneList[e.index].whetherPublic;return a||this.newDrag&&(this.cloneList[e.index].whetherPublic||this.$message({message:"不同分卷不可调整顺序！",type:"warning",showClose:!0}),this.newDrag=!1),a},dragStart:function(t){if(this.cloneList=JSON.parse(n()(this.chapterList)),this.newDrag=!0,this.cloneList[t.oldIndex].whetherPublic)return this.$message({message:"草稿箱内容不可调序",type:"warning",showClose:!0}),!1},dragEnd:function(t){var e=this,a=this.cloneList[t.oldIndex],s=this.cloneList[t.newIndex];this.$myLoad(),this.$ajax("/sys-chapteOrderUpdate",{startNum:a.chapterOrder,endNum:s.chapterOrder,bookid:a.bookId,volumeid:a.volumeId,startChapterid:a.id},function(t){e.$loading().close(),200===t.returnCode&&(e.getChapterList(),e.$message({message:"调整成功",type:"success",duration:2e3,showClose:!0}))})},toggleRowSelection:function(){var t=this,e=[];this.chapterList.forEach(function(t){t.check&&e.push(t.id)}),e.length?this.$confirm("此操作将永久删除所选的 "+e.length+" 个章节, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$ajax("/admin/deletechapter",{chapterid:e.toString()},function(e){200===e.returnCode&&(t.$message({message:"删除成功",type:"success"}),t.getChapterList())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})}):this.$message({message:"请选取要删除的章节！",type:"warning",showClose:!0})},selected:function(t){var e=this.chapterList[t];e.check?this.$set(e,"check",!1):this.$set(e,"check",!0)},selectAll:function(t){var e=this;t?this.chapterList.forEach(function(t){e.$set(t,"check",!0)}):this.chapterList.forEach(function(t){e.$set(t,"check",!1)})},handleSelectionChange:function(t){this.multipleSelection=t},handleRowClick:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleClick:function(t,e){"a"===t&&this.$router.push({path:"/edit_chapter/"+e.id})},handleCurrentChange:function(t){this.page=t,this.$router.push({params:{page:t}})},bookChangeState:function(t,e){var a=this,s=e.bookCheckStatus,i=e.bookStatus;"a"===t?s=1:"b"===t?0===e.bookCheckStatus?this.$message({message:"书籍暂未审核，请先审核通过！",type:"warning"}):s=2:"c"===t?e.bookCheckStatus<=1?this.$message({message:"书籍已下架！",type:"warning"}):s=1:"d"===t&&(i=1),this.$ajax("/admin/sysbookupdate",{bookId:e.bookId,bookCheckStatus:s,bookAuthorization:e.bookAuthorization,bookStatus:i},function(t){200===t.returnCode&&(a.$message(t.msg),a.getBookList())})}},created:function(){this.getBookInfo(),this.getChapterList()},watch:{$route:function(){this.getChapterList()}},computed:{nowTime:function(){var t=(new Date).getTime();return this.$ajax("/sys-getNetWorkDateTime","",function(e){200===e.returnCode&&(t=e.data.beijing)},"get"),t},authority:function(){return this.$store.state.userInfo.adminRolemenuanduserrole?this.$store.state.userInfo.adminRolemenuanduserrole:{}}},filters:{checkState:function(t){}}},l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"admin-book-wrap"},[a("el-breadcrumb",{staticClass:"mbt20",attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[t._v("书籍管理")]),t._v(" "),a("el-breadcrumb-item",{attrs:{to:"/book/list"}},[t._v("书籍列表")]),t._v(" "),a("el-breadcrumb-item",[t._v("章节列表")])],1),t._v(" "),a("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[a("div",[a("p",[t._v("此表为 "),a("span",{staticClass:"blue"},[t._v("《"+t._s(t.bookInfo.bookName)+"》")]),t._v("的全部章节列表")]),t._v(" "),a("p",[t._v("\n                操作：通过拖拽可以直接进行卷内章节调序，不同分卷之间章节不可调序；需要修改分卷名或调整分卷顺序请进入\n                "),t.authority.adds?a("router-link",{staticClass:"red",attrs:{to:{name:"bookVolumeList"}}},[t._v("分卷管理")]):t._e()],1),t._v(" "),a("p",[a("span",{staticClass:"red"},[t._v("注意事项：")]),t._v(" "),a("i",{staticClass:"el-icon-edit danger"}),t._v("表示草稿,草稿箱内容不可调序；\n                "),a("i",{staticClass:"el-icon-time danger"}),t._v("表示定时发布，超过当前服务器时间的章节内容会被自动发布；也可以直接\n                "),t.authority.adds?a("router-link",{staticClass:"red",attrs:{to:"/add_new_chapter/"+t.$route.params.bid}},[t._v("新建章节")]):t._e()],1)])]),t._v(" "),a("el-row",{staticClass:"mbt20"},[t.authority.deletes?a("el-button",{attrs:{type:"danger",plain:""},on:{click:t.toggleRowSelection}},[t._v("批量删除")]):t._e()],1),t._v(" "),a("el-row",[a("div",{staticClass:"table-wrap"},[a("table",{staticClass:"chapter-list",attrs:{border:"0",cellspacing:"10",cellpadding:"0",width:"100%"}},[a("thead",[a("tr",[a("th",[a("el-checkbox",{on:{change:t.selectAll}})],1),t._v(" "),a("th",[t._v("ID")]),t._v(" "),a("th",[t._v("分卷")]),t._v(" "),a("th",{attrs:{align:"left"}},[t._v("章节名")]),t._v(" "),a("th",[t._v("VIP状态")]),t._v(" "),a("th",[t._v("全部")]),t._v(" "),a("th",[t._v("发布时间")]),t._v(" "),a("th",[t._v("字数")]),t._v(" "),a("th",[t._v("操作")])])]),t._v(" "),a("draggable",{attrs:{options:{draggable:".drag-item"},element:"tbody",move:t.dragState},on:{start:t.dragStart,update:t.dragEnd},model:{value:t.chapterList,callback:function(e){t.chapterList=e},expression:"chapterList"}},t._l(t.chapterList,function(e,s){return a("tr",{key:e.id,staticClass:"drag-item",on:{click:function(e){t.selected(s)}}},[a("td",[a("el-checkbox",{model:{value:e.check,callback:function(a){t.$set(e,"check",a)},expression:"item.check"}})],1),t._v(" "),a("td",[t._v(t._s(e.id))]),t._v(" "),a("td",[t._v(t._s(e.volumeName))]),t._v(" "),a("td",{attrs:{align:"left"}},[t._v("\n                            "+t._s(e.chapterTitle)+"\n                            "),e.whetherPublic?a("i",{staticClass:"el-icon-edit danger"}):t.nowTime<e.releaseTime?a("i",{staticClass:"el-icon-time danger"}):t._e()]),t._v(" "),a("td",[e.chapterIsvip?a("span",{staticClass:"danger"},[t._v("VIP")]):a("span",{staticClass:"safe"},[t._v("普通")])]),t._v(" "),a("td",[e.chapterState?a("span",{staticClass:"danger"},[t._v("未审核")]):a("span",{staticClass:"safe"},[t._v("已审核")])]),t._v(" "),a("td",[t._v("\n                            "+t._s(t._f("time")(e.releaseTime,"long"))+"\n                        ")]),t._v(" "),a("td",[t._v(t._s(e.chapterLength))]),t._v(" "),a("td",[a("router-link",{staticClass:"blue",attrs:{target:"_blank",to:"/edit_chapter/"+e.id}},[t._v("编辑")])],1)])}))],1)]),t._v(" "),t.chapterList.length?a("el-pagination",{staticClass:"mbt20",attrs:{"current-page":t.page,"page-size":100,layout:"total, prev, pager, next, jumper",total:t.chapterList.length},on:{"current-change":t.handleCurrentChange}}):t._e()],1)],1)},h=[],d=a("18Nq"),u=s,g=Object(d.a)(c,l,h,!1,u,null,null);e.default=g.exports},Rq2q:function(t,e){}});
//# sourceMappingURL=58.a4b9b5a518566c5501a6.js.map