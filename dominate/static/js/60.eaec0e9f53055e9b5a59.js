webpackJsonp([60],{"7ban":function(e,t){},zCU7:function(e,t,r){"use strict";function o(e){r("7ban")}Object.defineProperty(t,"__esModule",{value:!0});var l=r("3cXf"),a=r.n(l),i={data:function(){var e=this,t=function(t,r,o){e.ruleForm.chapterLength?e.ruleForm.chapterLength>2e4?o(new Error("总长度不可超过20000字！")):o():o(new Error("请添加章节内容"))};return{loading:"",isPending:!1,dialogSize:"tiny",volumeList:[],isAutoPublish:!1,labelWidth:"136px",dialogFormVisible:!1,isVip:0,volumeForm:{volumeName:""},ruleForm:{bookTitle:"",chapterTitle:"",volumeId:null,releaseTime:"",chapterContent:"",whetherPublic:0,chapterLength:0,chapterIsvip:0,authorWords:""},rule:{volumeName:[{required:!0,validator:function(t,r,o){!r||e.$http.trim(r).length<1?(e.volumeForm.volumeName="",o(new Error("卷名不能为空"))):e.$ajax("/books-getCheckVolume",{volumeName:r,bookid:e.ruleForm.bookId},function(e){200===e.returnCode?o():o(new Error(e.msg))})},trigger:"blur"}]},rules:{chapterTitle:[{required:!0,validator:function(t,r,o){r=e.$http.trim(r),!r||e.$http.trim(r).length<1?(e.ruleForm.chapterTitle="",o(new Error("请输入章节名称"))):e.$ajax("/chapter-checkName",{chapterName:r,bookId:e.$route.params.bid},function(e){200===e.returnCode?o():o(new Error("章节名重复，请重新填写！"))})},trigger:"blur"}],volumeId:[{required:!0,type:"number",message:"请选择分卷",trigger:"change"}],bookTitle:[{required:!0,message:"请输入书籍名称",trigger:"blur"}],chapterContent:[{required:!0,validator:t,trigger:"change"}]}}},methods:{submitForm:function(e){var t=this;this.loading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),this.$refs.ChapterForm.validate(function(r){if(!r)return t.$nextTick(function(){t.loading.close()}),t.$message({message:"请完善必填信息！",type:"warning"}),!1;"draft"===e&&(t.ruleForm.whetherPublic=1),t.ruleForm.chapterIsvip?(t.$nextTick(function(){t.$loading().close()}),t.$alert("","确认设置为收费章节？",{confirmButtonText:"是",showCancelButton:!0,customClass:"small confirm-msg-box",cancelButtonText:"否",callback:function(e){"confirm"===e&&(t.loading=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.createChapter())}})):t.createChapter()})},createChapter:function(){var e=this,t=JSON.parse(a()(this.ruleForm));t.chapterContent=this.$http.trim(t.chapterContent).replace(/\n+\s+/g,"<H><LG>")+"<H><LG>",this.$ajax("/sys-getNetWorkDateTime","",function(r){200===r.returnCode?(t.releaseTime?t.releaseTime=e.$formTime(t.releaseTime,"long"):t.releaseTime=e.$formTime(r.data.beijing,"long"),e.$ajax("/admin/addAdminCreates",t,function(r){e.$nextTick(function(){e.loading.close()}),200===r.returnCode&&e.$confirm(t.whetherPublic?"草稿保存成功":"发布成功","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){window.scrollTo(0,0),e.resetForm("ChapterForm"),e.getChapterInfo()}).catch(function(){window.scrollTo(0,0),e.resetForm("ChapterForm"),e.getChapterInfo()})})):e.$nextTick(function(){e.loading.close()})},"get","json",!0)},addNewVolume:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.$ajax("/books-addvolume",{volumeName:t.volumeForm.volumeName,bookName:t.ruleForm.bookTitle,bookid:t.$route.params.bid},function(e){200===e.returnCode&&(t.dialogFormVisible=!1,t.$message("添加成功"),t.getChapterInfo())})})},resetForm:function(e){this.$refs[e].resetFields()},getChapterInfo:function(){var e=this;this.$ajax("/book-showBookInfo",{bookid:this.$route.params.bid},function(t){200===t.returnCode&&(e.ruleForm.bookTitle=t.data.bookName,e.ruleForm.bookId=t.data.bookId,e.ruleForm.bookWriterId=t.data.bookWriterId,e.isVip=t.data.bookCheckStatus,e.$ajax("/books-getvolume",{bookId:e.$route.params.bid},function(t){200===t.returnCode&&(e.volumeList=t.data)}))})},checkChapterName:function(e){e.target.value.length}},created:function(){var e=document.body.clientWidth;this.dialogSize=e<1020?"small":"tiny",this.getChapterInfo()},watch:{"ruleForm.chapterContent":function(e){this.ruleForm.chapterContent=e.replace(/^\s*\n+\s*/,"").replace(/\s*\n+\s*/g,"\n\n　　")},"ruleForm.authorWords":function(e){this.$http.trim(e).length>100&&(e=e.substr(0,100)),this.ruleForm.authorWords=e.replace(/^\s*\n+\s*/,"").replace(/\s*\n+\s*/g,"\n\n　　")}},computed:{length:function(){var e=0,t=this.ruleForm.chapterContent;try{t=t.replace(/(\r\n+|\s+| )+/g,"龘"),t=t.replace(/龘+/g,""),e+=t.length}catch(e){}return this.ruleForm.chapterLength=e,e>2e4&&this.$message({message:"字数长度不可超过20000！",type:"error"}),e}},mounted:function(){var e=this;window.onresize=function(){var t=document.body.clientWidth;e.dialogSize=t<1020?"small":"tiny"}}},n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wrapper"},[r("el-breadcrumb",{staticClass:"mbt20",attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",[e._v("书籍管理")]),e._v(" "),r("el-breadcrumb-item",{attrs:{to:"/book/list"}},[e._v("书籍列表")]),e._v(" "),r("el-breadcrumb-item",{attrs:{to:"/book_chapter_list/"+e.$route.params.bid}},[e._v("章节列表")]),e._v(" "),r("el-breadcrumb-item",[e._v("新建章节")])],1),e._v(" "),r("div",{staticClass:"form-wrapper"},[r("el-form",{ref:"ChapterForm",staticClass:"chapter-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":e.labelWidth,labelPosition:"left"}},[r("el-form-item",{attrs:{label:"书籍名称",prop:"bookTitle"}},[r("el-input",{staticStyle:{width:"260px"},attrs:{readonly:""},model:{value:e.ruleForm.bookTitle,callback:function(t){e.$set(e.ruleForm,"bookTitle",t)},expression:"ruleForm.bookTitle"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"分卷名称",prop:"volumeId"}},[r("el-select",{staticStyle:{width:"260px"},attrs:{placeholder:"请选择分卷"},model:{value:e.ruleForm.volumeId,callback:function(t){e.$set(e.ruleForm,"volumeId",t)},expression:"ruleForm.volumeId"}},[[e._l(e.volumeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.volumeName,value:e.id}})}),e._v(" "),r("el-option",{attrs:{label:"",value:""},nativeOn:{click:function(t){e.dialogFormVisible=!0}}},[e._v("+新增分卷")])]],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"章节名称",prop:"chapterTitle"}},[r("el-input",{staticStyle:{width:"260px"},on:{blur:function(t){e.checkChapterName(t)}},model:{value:e.ruleForm.chapterTitle,callback:function(t){e.$set(e.ruleForm,"chapterTitle",t)},expression:"ruleForm.chapterTitle"}})],1),e._v(" "),r("el-form-item",{staticClass:"contentBox",attrs:{label:"章节内容",prop:"chapterContent"}},[r("el-form-item",[r("el-input",{staticClass:"context",attrs:{type:"textarea",rows:15},model:{value:e.ruleForm.chapterContent,callback:function(t){e.$set(e.ruleForm,"chapterContent",t)},expression:"ruleForm.chapterContent"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"authorWords"}},[r("el-input",{staticClass:"authorSay-wrap",attrs:{type:"textarea",placeholder:"作者的话（不可超过100字）"},model:{value:e.ruleForm.authorWords,callback:function(t){e.$set(e.ruleForm,"authorWords",t)},expression:"ruleForm.authorWords"}})],1),e._v(" "),r("span",{staticClass:"words"},[e._v("共 "+e._s(e.length)+" 字")])],1),e._v(" "),r("el-form-item",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":e.labelWidth,label:"发布时间",prop:"releaseTime"}},[r("el-col",{attrs:{span:12}},[r("el-date-picker",{attrs:{type:"datetime",disabled:!e.isAutoPublish,placeholder:"选择时间"},model:{value:e.ruleForm.releaseTime,callback:function(t){e.$set(e.ruleForm,"releaseTime",t)},expression:"ruleForm.releaseTime"}}),e._v(" "),r("el-checkbox",{staticClass:"ml20",attrs:{label:"定时发布"},on:{change:function(t){e.ruleForm.releaseTime=e.isAutoPublish?e.ruleForm.releaseTime:""}},model:{value:e.isAutoPublish,callback:function(t){e.isAutoPublish=t},expression:"isAutoPublish"}})],1),e._v(" "),r("el-col",{attrs:{span:12}})],1),e._v(" "),r("el-form-item",{attrs:{"label-width":e.labelWidth,label:"是否VIP",prop:"chapterIsvip"}},[r("el-radio",{staticClass:"radio",attrs:{label:0},model:{value:e.ruleForm.chapterIsvip,callback:function(t){e.$set(e.ruleForm,"chapterIsvip",t)},expression:"ruleForm.chapterIsvip"}},[e._v("普通")]),e._v(" "),2===e.isVip?r("el-radio",{staticClass:"radio",attrs:{label:1},model:{value:e.ruleForm.chapterIsvip,callback:function(t){e.$set(e.ruleForm,"chapterIsvip",t)},expression:"ruleForm.chapterIsvip"}},[e._v("VIP")]):e._e()],1),e._v(" "),r("el-form-item",{staticClass:"tc",staticStyle:{width:"820px"},attrs:{"label-width":e.labelWidth}},[r("el-button",{staticClass:"fl",attrs:{type:"primary"},on:{click:function(t){e.submitForm("create")}}},[e._v("立即创建")]),e._v(" "),r("el-button",{staticClass:"fr save-draft",on:{click:function(t){e.submitForm("draft")}}},[e._v("保存草稿")])],1)],1)],1),e._v(" "),r("el-dialog",{staticClass:"alertDialog",attrs:{top:"45%",title:"新增分卷",visible:e.dialogFormVisible},on:{open:function(t){e.volumeForm.volumeName=""},"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"volumeForm",attrs:{model:e.volumeForm,rules:e.rule,"label-position":"left"}},[r("el-form-item",{attrs:{label:"分卷名称",prop:"volumeName","label-width":"80px"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.volumeForm.volumeName,callback:function(t){e.$set(e.volumeForm,"volumeName",t)},expression:"volumeForm.volumeName"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addNewVolume("volumeForm")}}},[e._v("确 定")])],1)],1)],1)},s=[],u=r("18Nq"),c=o,m=Object(u.a)(i,n,s,!1,c,null,null);t.default=m.exports}});
//# sourceMappingURL=60.eaec0e9f53055e9b5a59.js.map