webpackJsonp([24],{"4Nzc":function(e,t){},EeEo:function(e,t,a){"use strict";function o(e){a("4Nzc")}Object.defineProperty(t,"__esModule",{value:!0});var l={data:function(){return{loading:!1,currentType:"",typeList:[],searchValue:"",tableList:[],dialogFormVisible:!1,formValue:{},completeValue:"",restaurant:[],timeout:null,dialogImageUrl:"",dialogVisible:!1,bookclassid:""}},methods:{getRecommendList:function(){var e=this;this.$ajax("/sys-getRecommendedPosition",{},function(t){200===t.returnCode&&(e.typeList=t.data,e.searchValue=0,e.search())})},getBookClass:function(){var e=this;this.$ajax("/ranking-classification",{},function(t){200===t.returnCode&&(e.bookClassList=t.data)},"get")},search:function(){var e=this;this.$ajax("/sys-getRecommendedPositionByType",{RecommendpositionTypeid:this.typeList[this.searchValue].recommendType},function(t){200===t.returnCode&&(e.tableList=7===e.typeList[e.searchValue].recommendType?t.data.reverse():t.data)})},remoteMethod:function(e){var t=this,a=this.$http.trim(e);if(a.length>0){this.loading=!0;var o={keyWord:a,isHotWorld:1,startPage:1};this.typeList[this.searchValue].recommendName.indexOf("分类推荐")>-1&&(o.bookClassificationId=this.typeList[this.searchValue].bookClassificationId),this.$ajax("/stacks-search",o,function(a){t.loading=!1,200===a.returnCode&&(a.data.list.forEach(function(e){e.value=e.bookName+" ("+e.bookId+")"}),t.restaurant=a.data.list.filter(function(t){return t.bookName.toLowerCase().indexOf(e.toLowerCase())>-1}))})}else this.restaurant=[]},handleClick:function(e,t){this.typeList[this.searchValue].bookClassificationId;this.formValue={},this.$set(this.formValue,"type",t),this.$set(this.formValue,"bookImage",e.bookImage),this.$set(this.formValue,"id",e.id),this.dialogImageUrl="",this.dialogFormVisible=!0},handleSelect:function(e){this.formValue.bookimg=e.bookImage,this.formValue.bookWriterId=e.bookWriterId,this.formValue.bookId=e.bookId},editRecommend:function(){var e=this;this.formValue.bookId?this.$ajax("/admin/updateActivityRecommendedPosition",this.formValue,function(t){e.dialogFormVisible=!1,200===t.returnCode&&(e.completeValue="",e.formValue={},e.search())}):console.log(this.formValue)},handlePictureCard:function(e){this.formValue.bookImage=e.url},submitUpload:function(){this.$refs.upload.submit()},successBack:function(e,t){this.$message(e.msg),this.search(),this.dialogFormVisible=!1}},created:function(){this.getRecommendList()}},i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"book-recommend"},[a("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[a("p",[e._v("\n      请选取推荐位类型，按类型搜索需要修改的推荐位。图片轮播和右侧小图推荐位需要单独上传图片，请编辑完成后点击换图进行图片更换\n    ")]),e._v(" "),a("p",[a("span",{staticClass:"red"},[e._v("特别提示：")]),e._v("更换网站分类推荐时请添加当前分类下的书籍，否则将无法添加成功\n    ")])]),e._v(" "),a("el-row",{staticClass:"mbt20",attrs:{gutter:10}},[a("el-col",{attrs:{xs:18,sm:12,md:9,lg:6,xl:3}},[a("el-select",{attrs:{placeholder:"请选择","filter-method":e.search},on:{change:e.search},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.recommendName,value:t}})}))],1),e._v(" "),a("el-button",{staticClass:"fr",on:{click:function(t){e.$clearCache()}}},[e._v("清除缓存")])],1),e._v(" "),a("el-row",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableList,border:"",select:"row","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"recommendOrder",label:"序列号",width:"60",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"bookId",label:"书ID",width:"60",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"bookName",label:"书名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"writerName",label:"作者"}}),e._v(" "),a("el-table-column",{attrs:{prop:"recommendName",label:"推荐类型"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"书籍封面"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"bookCover",class:5==e.row.recommendType||4==e.row.recommendType||3==e.row.recommendType?"mw-auto":"",attrs:{src:e.row.bookImage,alt:e.row.bookName}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[3==e.typeList[e.searchValue].recommendType||4==e.typeList[e.searchValue].recommendType||5==e.typeList[e.searchValue].recommendType?a("el-row",{staticClass:"mb10"},[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleClick(t.row,"pic")}}},[e._v("换图")])],1):e._e(),e._v(" "),a("el-row",[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleClick(t.row,"edit")}}},[e._v("编辑")])],1)]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"edit"==e.formValue.type?"修改推荐位":"上传图片",width:"420px","close-on-press-escape":!1,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")]),e._v(" "),"pic"==e.formValue.type?a("div",{staticClass:"cover-wrap"},[a("div",{staticClass:"cover-preview"},[a("img",{attrs:{src:e.formValue.bookImage,alt:""}})]),e._v(" "),a("el-upload",{ref:"upload",staticClass:"upload-recommend",attrs:{name:"file",data:{recommendid:e.formValue.id},"show-file-list":!1,"on-change":e.handlePictureCard,"on-success":e.successBack,action:"/api/admin/updateimgUpload","auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传图片")])],1)],1):a("el-form",{attrs:{"label-width":"70px"}},[a("el-form-item",{attrs:{label:"书籍名称"}},[a("el-select",{attrs:{filterable:"",remote:"",clearable:"","remote-method":e.remoteMethod,placeholder:"请输入书名",loading:e.loading},on:{change:e.handleSelect},model:{value:e.completeValue,callback:function(t){e.completeValue=t},expression:"completeValue"}},e._l(e.restaurant,function(e,t){return a("el-option",{key:e.id,attrs:{label:e.bookName,value:e}})}))],1),e._v(" "),e.formValue.recommendName&&e.formValue.recommendName.indexOf("分类推荐")>-1?a("el-form-item",{attrs:{label:"分类名称",prop:"recommendName"}},[a("el-input",{model:{value:e.formValue.recommendName,callback:function(t){e.$set(e.formValue,"recommendName",t)},expression:"formValue.recommendName"}})],1):e._e()],1),e._v(" "),"edit"==e.formValue.type?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.editRecommend}},[e._v("确 定")])],1):e._e()],1)],1)},s=[],r=a("18Nq"),n=o,c=Object(r.a)(l,i,s,!1,n,null,null);t.default=c.exports}});
//# sourceMappingURL=24.933f3b7746770d8f77c7.js.map