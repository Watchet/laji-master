webpackJsonp([34],{"6rpU":function(e,t){},lvjh:function(e,t,o){"use strict";function a(e){o("6rpU")}Object.defineProperty(t,"__esModule",{value:!0});var s={components:{"pic-cropper":function(){return o("PsVy")}},data:function(){return{bookList:{},updateData:{},multipleSelection:[],keywords:"",selectType:"bookName",outerVisible:!1,innerVisible:!1,timeRange:[],bookId:"",performanceReview:[],byTimeData:[]}},methods:{getBookList:function(){var e=this,t={page:this.$route.params.page,orderParemeter:"bookId"},o=this.$http.trim(this.keywords);if(this.selectType&&o){if(("bookId"===this.selectType||"bookWriterId"===this.selectType)&&!Number(o))return this.$message({message:"ID必需为数字",type:"warning"}),!1;t[this.selectType]=o,this.bookList={}}this.$ajax("/admin/getBookInfoList",t,function(t){200===t.returnCode&&(e.bookList=t.data)})},searchBook:function(){1!==Number(this.$route.params.page)?this.$router.push({params:{page:1}}):this.getBookList()},toggleSelection:function(){var e=this;if(this.multipleSelection.length){var t=[];this.multipleSelection.forEach(function(e){t.push(e.bookId)}),this.$confirm("此操作将永久删除所选的"+t.length+"书籍, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$ajax("/admin/bookBatchDelete",{bookid:t.toString()},function(t){200===t.returnCode&&(e.$message({message:"删除成功！",type:"success"}),e.getBookList())})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})}else this.$message({message:" 请选择要删除的书籍！",type:"warning"})},handleRowClick:function(e,t,o){"操作"!==o.label&&this.$refs.multipleTable.toggleRowSelection(e)},handleSelectionChange:function(e){this.multipleSelection=e},handleClick:function(e,t){"a"===e?this.$router.push({path:"/book_chapter_list/"+t.bookId}):"b"===e?this.$router.push({path:"/book_detail/"+t.bookId}):"c"===e?this.$router.push({path:"/add_new_chapter/"+t.bookId}):"d"===e&&this.toggleSelection()},handleCurrentChange:function(e){this.$router.push({params:{page:e}})},bookChangeState:function(e,t){var o=this,a=t.bookCheckStatus,s=t.bookStatus;if("a"===e)a=1;else if("b"===e){if(0===t.bookCheckStatus)return this.$message({message:"书籍暂未审核，请先审核通过！",type:"warning"}),!1;a=2}else if("c"===e){if(t.bookCheckStatus<=1)return this.$message({message:"书籍已下架！",type:"warning"}),!1;a=1}else"d"===e?s=1:"e"===e?s=0:"f"===e&&(a=0);this.$ajax("/admin/sysbookupdate",{bookId:t.bookId,bookCheckStatus:a,bookAuthorization:t.bookAuthorization,bookStatus:s},function(e){200===e.returnCode&&(o.$message(e.msg),o.getBookList())})},openDialog:function(e){this.outerVisible=!0,this.bookId=e.bookId},queryInfo:function(){var e=this;this.performanceReview=[];var t={bookId:this.bookId,startTime:this.format(new Date(this.timeRange-26784e5),"start"),endTime:this.format(this.timeRange,"end")};this.$store.dispatch("getAuthorPerformanceReview",t).then(function(t){if(200===t.returnCode&&0!=t.data[0].counts){var o={};o.bookTitle=t.data[0].bookTitle,o.sumWorld1=t.data[0].sumWorld,o.counts1=t.data[0].counts,o.sumWorld2=t.data[1].sumWorld,o.counts2=t.data[1].counts,o.releaseTime=t.data[2].releaseTime,o.createUpdateCount=t.data[2].createUpdateCount,e.performanceReview.push(o)}})},chapterInfoByTime:function(){var e=this;this.byTimeData=[];var t={bookId:this.bookId,startTime:this.format(new Date(this.timeRange-26784e5),"start"),endTime:this.format(this.timeRange,"end")};this.$store.dispatch("getChapterInfoByTime",t).then(function(t){200===t.returnCode&&(e.byTimeData=t.data,e.innerVisible=!0)})},format:function(e,t){var o=e.getFullYear(),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,s=e.getDate()<10?"0"+e.getDate():e.getDate();if("start"===t)var l=o+"-"+a+"-"+s+" 00:00:00";else var l=o+"-"+a+"-"+s+" 23:59:59";return l},defaultTime:function(){var e=new Date;this.timeRange=e}},created:function(){this.getBookList(),this.defaultTime()},watch:{$route:function(){this.getBookList()},outerVisible:function(e){!1===e&&(this.defaultTime(),this.byTimeData=[],this.performanceReview=[])}}},l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"admin-book-wrap"},[o("el-alert",{attrs:{title:"操作说明",type:"info","show-icon":""}},[o("div",[o("p",[e._v("\n                此表为本站全部书籍列表，您可以通过相应书籍ID来批量管理，也可以通过\n                "),o("router-link",{staticClass:"red",attrs:{to:{name:"addNewBook"}}},[e._v("新建书籍")]),e._v("来添加新书\n            ")],1)])]),e._v(" "),o("el-row",{staticClass:"mbt20"},[o("el-col",{attrs:{xs:20,sm:16,md:12,lg:9,xl:6}},[o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.searchBook(t):null}},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}},[o("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.selectType,callback:function(t){e.selectType=t},expression:"selectType"}},[o("el-option",{attrs:{label:"书  名",value:"bookName"}}),e._v(" "),o("el-option",{attrs:{label:"作 者",value:"writerName"}}),e._v(" "),o("el-option",{attrs:{label:"书籍ID",value:"bookId"}}),e._v(" "),o("el-option",{attrs:{label:"作者ID",value:"bookWriterId"}}),e._v(" "),o("el-option",{attrs:{label:"手机号",value:"userPhone"}})],1),e._v(" "),o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchBook},slot:"append"})],1)],1)],1),e._v(" "),o("el-row",[o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.bookList.list,border:""},on:{"row-click":e.handleRowClick,"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",aligin:"center"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookId",label:"ID"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bookName",label:"书名"}}),e._v(" "),o("el-table-column",{attrs:{prop:"writerName",label:"作者"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookStatus",label:"连载"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"el-dropdown-link",class:t.row.bookStatus?"primary":"success"},[e._v("\n                        "+e._s(t.row.bookStatus?"已完结":"连载中")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookCheckStatus",label:"审核"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"el-dropdown-link",class:t.row.bookCheckStatus?"success":"primary"},[e._v("\n                        "+e._s(t.row.bookCheckStatus?"已审核":"未审核")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"bookStatus",label:"上架"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"el-dropdown-link",class:2===t.row.bookCheckStatus?"success":"primary"},[e._v("\n                        "+e._s(2==t.row.bookCheckStatus?"已上架":"未上架")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("time")(t.row.bookCreatedTime,"long")))])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("time")(t.row.lastUpdateTime,"long")))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"bookWorldCount",label:"字数",align:"center"}}),e._v(" "),e.$store.state.userInfo&&e.$store.state.userInfo.adminRolemenuanduserrole.updates?o("el-table-column",{staticClass:"last-column",attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("a",{attrs:{href:"javascript:0;"}},[e._v("详情")]),e._v(" "),o("i",{staticClass:"fa fa-eye",on:{click:function(o){e.openDialog(t.row)}}})]}}])}):e._e()],1),e._v(" "),o("el-pagination",{staticClass:"mbt20",attrs:{background:"","current-page":e.bookList.pageNum,"page-size":e.bookList.pageSize,layout:"total, prev, pager, next, jumper",total:e.bookList.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),o("el-dialog",{attrs:{title:"提示",visible:e.outerVisible},on:{"update:visible":function(t){e.outerVisible=t}}},[o("p",{staticClass:"title"},[e._v("请选择时间")]),e._v(" "),o("el-date-picker",{staticStyle:{margin:"20px 0"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.timeRange,callback:function(t){e.timeRange=t},expression:"timeRange"}}),e._v(" "),o("el-button",{staticStyle:{float:"right",margin:"20px"},attrs:{type:"primary",round:""},on:{click:function(t){e.queryInfo()}}},[e._v("查 询")]),e._v(" "),o("el-table",{staticStyle:{width:"100%","margin-bottom":"40px"},attrs:{data:e.performanceReview,border:""}},[o("el-table-column",{attrs:{prop:"bookTitle",label:"书籍名称"}}),e._v(" "),o("el-table-column",{attrs:{prop:"sumWorld1",label:"发布字数"}}),e._v(" "),o("el-table-column",{attrs:{prop:"counts1",label:"发布数量"}}),e._v(" "),o("el-table-column",{attrs:{prop:"sumWorld2",label:"创建字数"}}),e._v(" "),o("el-table-column",{attrs:{prop:"counts2",label:"创建数量"}}),e._v(" "),o("el-table-column",{attrs:{prop:"releaseTime",label:"发布是否过审"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.releaseTime>=7?o("i",{staticClass:"el-icon-success"}):e._e(),e._v(" "),t.row.releaseTime<7?o("i",{staticClass:"el-icon-error"}):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"创建是否过审"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.createUpdateCount>=7?o("i",{staticClass:"el-icon-success"}):e._e(),e._v(" "),t.row.createUpdateCount<7?o("i",{staticClass:"el-icon-error"}):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"counts2",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.chapterInfoByTime()}}},[e._v("更新预览")])]}}])})],1),e._v(" "),o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.byTimeData,border:"",height:"300"}},[o("el-table-column",{attrs:{prop:"bookId",label:"ID"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bookTitle",label:"书籍名"}}),e._v(" "),o("el-table-column",{attrs:{prop:"chapterTitle",label:"章节名"}}),e._v(" "),o("el-table-column",{attrs:{prop:"chapterLength",label:"章节字数"}}),e._v(" "),o("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("time")(t.row.createChapterTime,"long")))])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"发布时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("time")(t.row.releaseTime,"long")))])]}}])})],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.outerVisible=!1}}},[e._v("关 闭")])],1)],1)],1)},n=[],r=o("18Nq"),i=a,c=Object(r.a)(s,l,n,!1,i,null,null);t.default=c.exports}});
//# sourceMappingURL=34.4d851bd93b1309cf43ee.js.map